<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GSU Cipherstorm</title>
<link rel="icon" href="GSU_LOGO.png" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
<style>
  :root{
    --gsu-red:#e60023; --bg:#000; --fg:#fff; --muted:#c7c7c7;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --safe-left: env(safe-area-inset-left, 0px);
    --safe-right: env(safe-area-inset-right, 0px);
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0}
  body{
    font-family:'Orbitron',sans-serif; background:var(--bg); color:var(--fg);
    min-height:100svh;
    padding:calc(12px + var(--safe-top)) calc(16px + var(--safe-right))
            calc(16px + var(--safe-bottom)) calc(16px + var(--safe-left));
    display:flex; flex-direction:column; align-items:center; gap:14px;
    -webkit-text-size-adjust:100%;
  }

  header{width:100%; display:flex; flex-direction:column; align-items:center; gap:8px}
  .logo{display:flex; flex-direction:column; align-items:center}
  .logo img{width:clamp(88px,12vw,120px); height:auto}
  .logo .text{letter-spacing:2px; opacity:.9}
  nav{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
  nav a{color:#fff; text-decoration:none; background:var(--gsu-red); padding:.6rem 1rem; border-radius:14px; font-weight:700}

  /* The entire game lives in .frame ‚Äî we scale this to fit the viewport */
  .frame{
    width:min(980px, 96vw);
    border:3px solid var(--gsu-red); border-radius:16px; padding:14px;
    box-shadow:0 0 18px #e60023cc, inset 0 0 18px #e6002326;
    background:linear-gradient(#0a0a0a,#000);
    transform-origin: top center;
  }
  h1{margin:6px 0 0 6px}
  h2.sub{margin:4px 0 10px 6px; color:var(--gsu-red); font-size:1rem; opacity:.9}

  .hud{
    display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-bottom:10px;
    font-size:clamp(.8rem,2vw,1rem);
  }
  .pill{background:#111; border:1px solid #2a2a2a; border-radius:10px; padding:8px; text-align:center}
  .pill strong{color:var(--gsu-red)}

  #board{
    position:relative;
    width:100%;
    height:520px; /* visual size before scaling ‚Äî stays consistent */
    border:2px solid #222; border-radius:12px; overflow:hidden;
    background:
      linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
    background-size:40px 40px;
    box-shadow:0 0 20px #e60023aa inset;
    margin: 6px auto 10px;
    isolation:isolate;
    touch-action:manipulation;
  }

  .tile{
    position:absolute; left:50%; transform:translateX(-50%);
    padding:12px 16px; background:#0b0b0b; border:1px solid #333; border-radius:12px;
    box-shadow:0 0 14px rgba(230,0,35,.35);
    font-size:clamp(1rem,3.4vw,1.35rem);
    transition: outline-color .12s ease, box-shadow .12s ease;
  }
  .tile .word{color:#f3f3f3}
  .tile .hint{color:var(--muted); font-size:.85em; margin-top:2px}
  .ok{outline:2px solid #21d07a}
  .bad{outline:2px solid #d02121}

  .controls{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px}
  #typed{
    width:min(520px, 90%);
    font-family:inherit; font-size:16px;  /* prevent iOS zoom */
    color:#fff; background:#0a0a0a;
    border:1px solid #333; border-radius:10px; padding:12px 14px; outline:none;
    box-shadow:0 0 8px rgba(255,255,255,.05);
  }
  .btn{
    border:none; background:var(--gsu-red); color:#fff; padding:10px 16px; border-radius:10px; cursor:pointer;
    box-shadow:0 0 10px #e60023aa; font-weight:700; font-size:16px;
  }
  .btn:disabled{opacity:.6; cursor:not-allowed}

  footer{opacity:.7; font-size:.85rem; text-align:center; margin-top:10px}

  @media (max-width:900px){ .hud{grid-template-columns:repeat(4,1fr)} }
  @media (max-width:640px){ .hud{grid-template-columns:repeat(3,1fr)} }
</style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="GSU_LOGO.png" alt="GSU Logo" />
      <div class="text">GAMESYNC UNION</div>
    </div>
    <nav><a href="index.html">Home</a></nav>
  </header>

  <section class="frame" id="frame">
    <h1>GSU CIPHERSTORM</h1>
    <h2 class="sub">Unscramble the word before it hits the bottom.</h2>

    <div class="hud">
      <div class="pill">‚è± <strong id="time">60</strong>s</div>
      <div class="pill">üî¢ Wave <strong id="wave">1</strong></div>
      <div class="pill">üî• Streak <strong id="streak">0</strong></div>
      <div class="pill">‚≠ê Score <strong id="score">0</strong></div>
      <div class="pill">‚ù§Ô∏è <strong id="lives">3</strong></div>
      <div class="pill">‚ö° Surge <strong id="surge">‚Äî</strong></div>
      <div class="pill">üéØ MaxLen <strong id="len">4</strong></div>
    </div>

    <div id="board" aria-live="polite"></div>

    <div class="controls">
      <input id="typed" type="text" placeholder="Type the correct word, then press Enter‚Ä¶" autocomplete="off" autocapitalize="off" autocorrect="off" />
      <button class="btn" id="startBtn">‚ñ∂ Start Run</button>
      <button class="btn" id="slowmoBtn" disabled>‚ö° Power Surge</button>
      <button class="btn" id="fitBtn">üîç Fit to Screen</button>
    </div>

    <div class="row" style="color:var(--muted); text-align:center; margin-top:6px;">
      Tip: your tile glows green while your typed prefix is correct.
    </div>

    <footer>Built for GameSync Union ‚Äî GSU Cipherstorm‚Ñ¢</footer>
  </section>

<script>
/* ---------------- Auto-scale the whole frame so everything is visible on open ---------------- */
const frame = document.getElementById('frame');
const typed = document.getElementById('typed');
const fitBtn = document.getElementById('fitBtn');

let typing = false;

function viewportH(){ return (window.visualViewport ? window.visualViewport.height : window.innerHeight); }

function fitFrame(auto=true){
  // Temporarily reset to natural size to measure
  frame.style.transform = 'scale(1)';
  const top = frame.getBoundingClientRect().top;
  const visible = viewportH();
  // A little cushion so the frame isn't glued to edges
  const cushion = 10;
  const maxHeight = Math.max(300, visible - top - cushion);

  const needed = frame.getBoundingClientRect().height;
  const scale = Math.min(1, maxHeight / needed);

  frame.style.transformOrigin = 'top center';
  frame.style.transform = `scale(${scale})`;

  if (!auto){
    frame.style.transition='transform .12s ease';
    requestAnimationFrame(()=> frame.style.transition='');
  }
}

// Refit when the viewport changes, but pause while typing so the keyboard doesn't cause jumps
window.addEventListener('resize', ()=>!typing && fitFrame(true));
window.visualViewport?.addEventListener('resize', ()=>!typing && fitFrame(true));
window.addEventListener('orientationchange', ()=>fitFrame(true));
fitBtn.addEventListener('click', ()=>fitFrame(false));

typed.addEventListener('focus', ()=> typing = true);
typed.addEventListener('blur',  ()=> { typing = false; fitFrame(true); });

fitFrame(true);

/* ---------------- Game logic (short words / gentle speed) ---------------- */
const WORD_BANK = {
  games:["rank","buff","nerf","tech","tilt","grab","chip","roll","dash","jump","kick","throw","guard","meter","combo","parry",
         "aim","ping","lag","farm","gank","bait","poke","zone","stun","root","bind","smite","spray","carry","steal","skill",
         "stack","stats","quest","equip","dodge","feint","super","ultra","patch","boss","raid","loot","gold","coins","armor",
         "spawn","smurf","macro","micro","ghost","score","reset","stage","match","camp","heal","perks","runes","punch","block",
         "slide","burst","clash","scope","tilt"],
  tech:["byte","data","code","build","stack","array","debug","query","cache","ping","queue","input","index","token","regex","route","param","class","scope","state","event","logic","parse","print","stdin","shell","linux","macos","proxy","redis","mongo","nexus","azure","cloud","https","http","email","hash","salt","merge","split","shift","node","deno","rust","java","perl","bash","zsh","grep","pipe","host","port","path","link","uuid","yaml","json","nano","yarn","vim","npm"],
  heroes:["loki","thor","miles","storm","blade","nova","wasp","hulk","rogue","Spider","Sonic","Mario","Luigi","Peach","Tails",
          "Link","Zelda","Ryu","Ken","Akuma","Sagat","Venom","Cable","Groot","Logan","Peter","Gwen","Zorro","Sora","Riku",
          "Tifa","Cloud","Ellie","Abby","Joel","Lara","Samus","Yoshi","Kirby","Ness","Lucas","Robin","Flash","Rogue","Miles","Venom"]
};
const THEMES = Object.keys(WORD_BANK);
const board   = document.getElementById('board');
const timeEl  = document.getElementById('time');
const waveEl  = document.getElementById('wave');
const scoreEl = document.getElementById('score');
const streakEl= document.getElementById('streak');
const livesEl = document.getElementById('lives');
const surgeEl = document.getElementById('surge');
const lenEl   = document.getElementById('len');
const startBtn= document.getElementById('startBtn');
const slowmoBtn = document.getElementById('slowmoBtn');

function sample(a){ return a[Math.floor(Math.random()*a.length)] }
function pickTheme(){ return sample(THEMES) }
function scrambleWord(w){
  if (w.length <= 3) return w;
  const first = w[0], last = w[w.length-1];
  const mid = w.slice(1,-1).split("");
  for (let i=mid.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [mid[i],mid[j]]=[mid[j],mid[i]]; }
  const s = first + mid.join("") + last;
  return (s===w) ? first + mid.reverse().join("") + last : s;
}

let state=null, rafId=null, timerId=null, slowId=null, theme="games";
const BASE_SPEED=55, SPEED_PER_WAVE=8, MAX_SPEED=160, SLOW_FACTOR=0.6;

function initialState(){
  return {time:60,lives:3,score:0,streak:0,wave:1,running:false,
          activeTile:null,powerReady:false,slow:false,lastT:0};
}
function speed(){
  const raw = BASE_SPEED + (state.wave-1)*SPEED_PER_WAVE;
  const s = Math.min(raw, MAX_SPEED);
  return state.slow ? s*SLOW_FACTOR : s;
}
function setHUD(){
  timeEl.textContent=state.time; livesEl.textContent=state.lives;
  scoreEl.textContent=state.score; streakEl.textContent=state.streak;
  waveEl.textContent=state.wave; slowmoBtn.disabled=!state.powerReady||state.slow||!state.running;
  surgeEl.textContent = state.powerReady ? "Ready" : (state.slow ? "Active" : "‚Äî");
  lenEl.textContent = state.wave<=3 ? "4" : "5";
}

/* Tiles */
function allowedMaxLen(){ return state.wave<=3 ? 4 : 5; }
function spawnTile(){
  const words = WORD_BANK[theme].filter(w=>w.length<=allowedMaxLen());
  const word = sample(words), scram = scrambleWord(word);
  const tile = document.createElement('div');
  tile.className='tile'; tile.style.top='-52px'; tile.style.left=`${15+Math.random()*70}%`;
  const hint = word[0] + " " + "_ ".repeat(Math.max(0,word.length-2)) + word[word.length-1];
  tile.innerHTML = `<div class="word">${scram}</div><div class="hint">${hint.trim()}</div>`;
  board.appendChild(tile);
  state.activeTile = {el:tile, y:-52, word, scram};
}

function clearTile(ok){
  if(!state.activeTile) return;
  const el = state.activeTile.el; el.classList.add(ok?'ok':'bad');
  state.activeTile = null; setTimeout(()=>el.remove(),160);
}
function nextWave(){ state.wave++; if(state.wave%4===0) state.powerReady=true; }
function loop(ts){
  if(!state.running) return;
  if(!state.lastT) state.lastT = ts;
  const dt = Math.min(0.05, (ts - state.lastT)/1000); state.lastT = ts;

  if(state.activeTile){
    state.activeTile.y += speed()*dt;
    state.activeTile.el.style.top = `${state.activeTile.y}px`;
    if (state.activeTile.y > board.clientHeight - 60){
      clearTile(false); state.streak=0; state.lives--; setHUD();
      if(state.lives<=0){ endRun(); return; }
      spawnTile();
    }
  }
  rafId = requestAnimationFrame(loop);
}

/* Control */
function startRun(){
  if(state?.running) return;
  cancelAnimationFrame(rafId); clearInterval(timerId); clearTimeout(slowId);
  board.innerHTML=""; typed.value=""; theme = pickTheme();
  state = initialState(); state.running=true; setHUD(); spawnTile();

  timerId = setInterval(()=>{
    if(!state.running) return;
    state.time--; if(state.time<=0){ state.lives=0; endRun(); }
    setHUD();
  },1000);

  state.lastT=0; rafId=requestAnimationFrame(loop);
  typed.focus({preventScroll:true});
  fitFrame(true);   // ensure the whole frame still fits after starting
}
function endRun(){
  state.running=false; cancelAnimationFrame(rafId); clearInterval(timerId); clearTimeout(slowId);
  startBtn.textContent="üîÅ Run Again";
  fitFrame(true);
}
function submitWord(){
  if(!state.running || !state.activeTile) return;
  const guess = typed.value.trim().toLowerCase(); if(!guess) return;
  const target = state.activeTile.word.toLowerCase();
  if(guess===target){
    const base = 100*target.length; state.streak=Math.min(999,state.streak+1);
    const bonus = 1 + Math.min(0.5, state.streak*0.1);
    state.score += Math.floor(base*bonus);
    clearTile(true); typed.value=""; nextWave(); spawnTile(); setHUD();
  }else{
    const el = state.activeTile.el; el.classList.add('bad'); setTimeout(()=>el.classList.remove('bad'),140);
    state.streak=0; setHUD();
  }
}
function useSlow(){
  if(!state.powerReady || state.slow || !state.running) return;
  state.powerReady=false; state.slow=true; setHUD();
  slowId=setTimeout(()=>{ state.slow=false; setHUD(); },5000);
}

/* Events */
startBtn.addEventListener('click', startRun);
slowmoBtn.addEventListener('click', useSlow);
typed.addEventListener('keydown', (e)=>{
  if(e.key==='Enter'){ e.preventDefault(); submitWord(); return; }
  if (state?.activeTile){
    const g = (typed.value + (e.key.length===1? e.key : "")).toLowerCase();
    const target = state.activeTile.word.toLowerCase();
    const okPrefix = target.startsWith(g.trim());
    state.activeTile.el.style.boxShadow = okPrefix
      ? "0 0 16px rgba(33,208,122,.55)"
      : "0 0 14px rgba(208,33,33,.55)";
  }
});
window.addEventListener('keydown', ()=>{
  if(state?.running && document.activeElement!==typed){ typed.focus({preventScroll:true}); }
});
</script>
</body>
</html>
