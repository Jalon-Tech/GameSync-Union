<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GSU Cipherstorm</title>
<link rel="icon" href="GSU_LOGO.png" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
<style>
  :root{
    --gsu-red:#e60023; --bg:#000; --fg:#fff; --muted:#c7c7c7;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --safe-left: env(safe-area-inset-left, 0px);
    --safe-right: env(safe-area-inset-right, 0px);
  }
  *{box-sizing:border-box}

  html, body{height:100%}
  html, body{margin:0; overflow-x:hidden;}
  body{
    font-family:'Orbitron',sans-serif; background:var(--bg); color:var(--fg);
    min-height:100svh; display:flex; flex-direction:column; align-items:center;
    padding:calc(12px + var(--safe-top)) calc(16px + var(--safe-right))
            calc(16px + var(--safe-bottom)) calc(16px + var(--safe-left));
    -webkit-text-size-adjust: 100%;
    gap:14px;
  }

  /* Scaled wrapper: header + board only (NOT the input!) */
  #game-wrapper{
    transform-origin: top center;
    width:100%;
    display:flex; flex-direction:column; align-items:center; gap:14px;
  }

  header{display:flex; flex-direction:column; align-items:center; gap:8px}
  nav{display:flex; flex-wrap:wrap; gap:10px; justify-content:center}
  nav a{color:#fff; text-decoration:none; background:var(--gsu-red); padding:8px 12px; border-radius:10px}
  .logo{display:flex; flex-direction:column; align-items:center}
  .logo img{max-width:96px}
  .logo .text{letter-spacing:2px; opacity:.9}

  .frame{
    width:min(900px,95vw);
    border:3px solid var(--gsu-red); border-radius:16px; padding:12px;
    box-shadow:0 0 18px #e60023cc, inset 0 0 18px #e6002326;
    background:linear-gradient(#0a0a0a,#000);
  }

  .hud{
    display:grid; grid-template-columns:repeat(5,1fr); gap:8px; margin-bottom:10px; font-size:clamp(.8rem,2vw,1rem);
  }
  .pill{background:#111; border:1px solid #2a2a2a; border-radius:10px; padding:8px; text-align:center}
  .pill strong{color:var(--gsu-red)}

  #board{
    position:relative; height:min(520px,62vh); overflow:hidden; border:1px solid #222; border-radius:12px;
    background-image:
      linear-gradient(to right,rgba(255,255,255,.06) 1px,transparent 1px),
      linear-gradient(to bottom,rgba(255,255,255,.06) 1px,transparent 1px);
    background-size:40px 40px; isolation:isolate;
    touch-action:manipulation;
  }

  .tile{
    position:absolute; left:50%; transform:translateX(-50%);
    padding:12px 16px; background:#0b0b0b; border:1px solid #333; border-radius:12px;
    box-shadow:0 0 14px rgba(230,0,35,.35);
    font-size:clamp(1rem,3.4vw,1.35rem);
    transition: outline-color .12s ease, box-shadow .12s ease;
  }
  .tile .word{color:#f3f3f3}
  .tile .hint{color:var(--muted); font-size:.85em; margin-top:2px}
  .ok{outline:2px solid #21d07a}
  .bad{outline:2px solid #d02121}

  /* Controls LIVE OUTSIDE the scaled wrapper so iOS keyboard doesn't glitch */
  .controls{
    margin-top:2px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center;
    width:100%;
  }
  #typed{
    width:min(520px,90%); font-family:inherit;
    /* Prevent iOS zoom-on-focus: ensure >= 16px */
    font-size: max(16px, 1.05rem);
    color:#fff; background:#0a0a0a;
    border:1px solid #333; border-radius:10px; padding:12px 14px; outline:none;
    box-shadow:0 0 8px rgba(255,255,255,.05);
    /* Keep it visible when keyboard opens */
    scroll-margin: 15vh;
  }
  #startBtn, .btn{
    border:none; background:var(--gsu-red); color:#fff; padding:10px 16px; border-radius:10px; cursor:pointer;
    box-shadow:0 0 10px #e60023aa; font-weight:700;
    font-size:max(16px, 1rem); /* no zoom on these either */
  }
  #startBtn:hover,.btn:hover{filter:brightness(1.1)}
  .row{display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
  .hintline{color:var(--muted); text-align:center}

  footer{opacity:.7; font-size:.85rem}

  @media (max-width:640px){ .hud{grid-template-columns:repeat(2,1fr)} }

  /* While typing, we suppress re-scaling to avoid jumps */
  body.typing #game-wrapper{ will-change: auto; }
</style>
</head>
<body>
  <!-- Scaled stuff -->
  <div id="game-wrapper">
    <header>
      <div class="logo">
        <img src="GSU_LOGO.png" alt="GSU Logo">
        <div class="text">GAMESYNC UNION</div>
      </div>
      <nav><a href="index.html">Home</a></nav>
    </header>

    <section class="frame">
      <h1 style="margin:6px 0 10px 6px;">GSU CIPHERSTORM</h1>
      <div class="hud">
        <div class="pill">‚è± <strong id="time">60</strong>s</div>
        <div class="pill">üî¢ Wave <strong id="wave">1</strong></div>
        <div class="pill">üî• Streak <strong id="streak">0</strong></div>
        <div class="pill">‚≠ê Score <strong id="score">0</strong></div>
        <div class="pill">‚ù§Ô∏è <strong id="lives">3</strong></div>
      </div>

      <div id="board" aria-live="polite"></div>
    </section>
  </div>

  <!-- NOT scaled: input & buttons (fixes iOS keyboard issues) -->
  <div class="controls">
    <input id="typed" type="text" placeholder="Type the correct word, then press Enter‚Ä¶" autocomplete="off" />
    <button id="startBtn">‚ñ∂ Start Run</button>
    <button class="btn" id="slowmoBtn" disabled>‚ö° Power Surge</button>
  </div>
  <div class="row hintline" style="margin-top:6px;">
    <span>Tip: your tile glows green while your typed prefix is correct.</span>
  </div>

  <footer>Built for GameSync Union ‚Äî GSU Cipherstorm‚Ñ¢</footer>

<script>
/* ===== Global auto-scale (don‚Äôt scale the input area) ===== */
(function(){
  const vvp = () => window.visualViewport || { width: innerWidth, height: innerHeight };
  const wrapper = document.getElementById('game-wrapper');

  function scalePage(){
    if(!wrapper) return;
    if (document.body.classList.contains('typing')) return; // skip while keyboard is up/typing
    wrapper.style.transform = 'scale(1)'; // reset
    const contentH = wrapper.scrollHeight;
    const contentW = wrapper.scrollWidth;
    const vw = vvp().width, vh = vvp().height;

    const sH = (vh - 2) / contentH;
    const sW = (vw - 2) / contentW;
    let scale = Math.min(sH, sW);
    if (scale > 1) scale = 1;
    scale = Math.max(0.6, scale);
    wrapper.style.transform = `scale(${scale})`;
  }

  let raf=null;
  function requestFit(){ if(raf) cancelAnimationFrame(raf); raf = requestAnimationFrame(scalePage); }

  addEventListener('load', requestFit);
  addEventListener('resize', requestFit);
  addEventListener('orientationchange', requestFit);
  window.visualViewport && visualViewport.addEventListener('resize', ()=>{
    if (!document.body.classList.contains('typing')) requestFit();
  });

  // Public refresh (call after big layout changes)
  window.gsuFit = { refresh: requestFit };
})();
</script>

<script>
/* ------------------------ Easier Word Lists (3‚Äì5 letters only) ------------------------ */
const WORD_BANK = {
games: [
  "rank","buff","nerf","tech","tilt","grab","chip","roll","dash","jump","kick","throw","guard","meter","combo","parry",
  "aim","ping","lag","farm","gank","bait","poke","zone","stun","root","bind","smite","spray","carry","steal","skill",
  "stack","stats","quest","equip","dodge","feint","super","ultra","patch","boss","raid","loot","gold","coins","armor",
  "spawn","smurf","macro","micro","ghost","score","reset","stage","match","camp","heal","perks","runes","punch","block",
  "slide","burst","clash","scope","tilt"
],
tech: [
  "byte","data","code","build","stack","array","debug","query","cache","ping","queue","input",
  "index","token","regex","route","param","class","scope","state","event","logic","parse","print",
  "stdin","shell","linux","macos","proxy","redis","mongo","nexus","azure","cloud","https","http",
  "email","hash","salt","merge","split","shift","node","deno","rust","java","perl","bash","zsh",
  "grep","pipe","host","port","path","link","uuid","yaml","json","nano","yarn","vim","npm"
],
heroes: [
  "loki","thor","miles","storm","blade","nova","wasp","hulk","rogue","Spider","Sonic",
  "Mario","Luigi","Peach","Tails","Link","Zelda","Ryu","Ken","Akuma","Sagat","Venom","Cable","Groot","Logan",
  "Peter","Gwen","Zorro","Sora","Riku","Tifa","Cloud","Ellie","Abby","Joel","Lara","Samus","Yoshi","Kirby",
  "Ness","Lucas","Robin","Flash","Rogue","Miles","Venom"
]
};
const THEMES = Object.keys(WORD_BANK);

/* ------------------------ DOM ------------------------ */
const board   = document.getElementById('board');
const timeEl  = document.getElementById('time');
const waveEl  = document.getElementById('wave');
const scoreEl = document.getElementById('score');
const streakEl= document.getElementById('streak');
const livesEl = document.getElementById('lives');
const typed   = document.getElementById('typed');
const startBtn= document.getElementById('startBtn');
const slowmoBtn = document.getElementById('slowmoBtn');

/* ------------------------ Helpers ------------------------ */
function pickTheme(){ return THEMES[Math.floor(Math.random()*THEMES.length)] }
function sample(list){ return list[Math.floor(Math.random()*list.length)] }

/* Easier scramble: ALWAYS keep first & last letters fixed */
function scrambleWord(w){
  if (w.length <= 3) return w;
  const first = w[0], last = w[w.length-1];
  const mid = w.slice(1,-1).split("");
  for (let i = mid.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [mid[i], mid[j]] = [mid[j], mid[i]];
  }
  const scram = first + mid.join("") + last;
  return (scram === w) ? first + mid.reverse().join("") + last : scram;
}

/* ------------------------ State ------------------------ */
let state = null;
let rafId = null, timerId = null, slowId = null;
let theme = "games";

/* Slower, smoother speeds */
const BASE_SPEED = 55;      // px/sec
const SPEED_PER_WAVE = 8;   // add per wave
const MAX_SPEED = 160;      // clamp
const SLOW_FACTOR = 0.6;    // Power Surge

function initialState(){
  return {
    time: 60, lives:3, score:0, streak:0, wave:1, running:false,
    activeTile:null, powerReady:false, slow:false, seed:crypto.randomUUID(),
    lastT: 0
  }
}

function currentSpeed(){
  const raw = BASE_SPEED + (state.wave-1)*SPEED_PER_WAVE;
  const s = Math.min(raw, MAX_SPEED);
  return state.slow ? s*SLOW_FACTOR : s;
}

function setHUD(){
  timeEl.textContent = state.time;
  livesEl.textContent = state.lives;
  scoreEl.textContent = state.score;
  streakEl.textContent= state.streak;
  waveEl.textContent  = state.wave;
  slowmoBtn.disabled  = !state.powerReady || state.slow || !state.running;
}

/* ------------------------ Spawning (easier selection) ------------------------ */
function allowedMaxLen(){
  if (state.wave <= 3) return 4;
  return 5;
}

function spawnTile(){
  const words = WORD_BANK[theme].filter(w => w.length <= allowedMaxLen());
  const word = sample(words);
  const scram = scrambleWord(word);

  const tile = document.createElement('div');
  tile.className='tile';
  tile.style.top='-52px';
  tile.style.left = `${15 + Math.random()*70}%`;

  const hintMask = word[0] + " " + "_ ".repeat(Math.max(0,word.length-2)) + word[word.length-1];
  tile.innerHTML = `<div class="word">${scram}</div><div class="hint">${hintMask.trim()}</div>`;
  board.appendChild(tile);

  state.activeTile = {el:tile, y:-52, word, scram};
}

/* ------------------------ Game Loop ------------------------ */
function clearTile(ok){
  if(!state.activeTile) return;
  const el = state.activeTile.el;
  el.classList.add(ok? 'ok':'bad');
  state.activeTile = null;
  setTimeout(()=> el.remove(), 160);
}

function nextWave(){
  state.wave++;
  if (state.wave % 4 === 0) state.powerReady = true;
}

function loop(ts){
  if (!state.running) return;
  if (!state.lastT) state.lastT = ts;
  const dt = Math.min(0.05, (ts - state.lastT) / 1000);
  state.lastT = ts;

  if (state.activeTile){
    const px = currentSpeed() * dt;
    state.activeTile.y += px;
    state.activeTile.el.style.top = `${state.activeTile.y}px`;

    if (state.activeTile.y > board.clientHeight - 60){
      clearTile(false);
      state.streak = 0;
      state.lives--;
      setHUD();
      if (state.lives <= 0){ endRun(); return; }
      spawnTile();
    }
  }
  rafId = requestAnimationFrame(loop);
}

/* ------------------------ Game Control ------------------------ */
function startRun(){
  if (state?.running) return;
  cancelAnimationFrame(rafId); clearInterval(timerId); clearTimeout(slowId);
  board.innerHTML = ""; typed.value = "";
  theme = pickTheme();
  state = initialState();
  state.running = true;
  setHUD();
  spawnTile();

  timerId = setInterval(()=>{
    if(!state.running) return;
    state.time--;
    if(state.time<=0){ state.lives=0; endRun(); }
    setHUD();
  },1000);

  state.lastT = 0;
  rafId = requestAnimationFrame(loop);

  // Re-scale the non-input area after UI changes
  window.gsuFit?.refresh();

  // put caret in the input & scroll it nicely into view
  typed.focus({ preventScroll:false });
  typed.scrollIntoView({ block:'center', behavior:'smooth' });
}

function endRun(){
  state.running=false;
  cancelAnimationFrame(rafId);
  clearInterval(timerId);
  clearTimeout(slowId);
  const frame = document.querySelector('.frame');
  const prev = frame.style.boxShadow;
  frame.style.boxShadow="0 0 30px #e60023, inset 0 0 18px #e6002344";
  setTimeout(()=> frame.style.boxShadow=prev || "0 0 18px #e60023cc, inset 0 0 18px #e6002326", 280);
  startBtn.textContent="üîÅ Run Again";
  window.gsuFit?.refresh();
}

/* Submit + live assist */
function submitWord(){
  if(!state.running || !state.activeTile) return;
  const guess = typed.value.trim().toLowerCase();
  if (!guess) return;
  const target = state.activeTile.word.toLowerCase();

  if (guess === target){
    const base = 100 * target.length;
    state.streak = Math.min(999, state.streak + 1);
    const streakBonus = 1 + Math.min(0.5, state.streak*0.1);
    state.score += Math.floor(base * streakBonus);
    clearTile(true);
    typed.value="";
    nextWave();
    spawnTile();
    setHUD();
  } else {
    const el = state.activeTile.el;
    el.classList.add('bad');
    setTimeout(()=> el.classList.remove('bad'), 140);
    state.streak = 0;
    setHUD();
  }
}

/* Power Surge */
function useSlow(){
  if(!state.powerReady || state.slow || !state.running) return;
  state.powerReady=false; state.slow=true; setHUD();
  slowId = setTimeout(()=>{ state.slow=false; setHUD(); }, 5000);
}

/* ------------------------ Events ------------------------ */
startBtn.addEventListener('click', startRun);
slowmoBtn.addEventListener('click', useSlow);

typed.addEventListener('focus', ()=>{
  document.body.classList.add('typing');           // pause re-scaling
  setTimeout(()=> typed.scrollIntoView({block:'center'}), 50);
});
typed.addEventListener('blur', ()=>{
  document.body.classList.remove('typing');        // resume re-scaling
  window.gsuFit?.refresh();
});

typed.addEventListener('keydown', (e)=>{
  if(e.key==='Enter'){ e.preventDefault(); submitWord(); return; }
  if (state?.activeTile){
    const g = (typed.value + (e.key.length===1? e.key : "")).toLowerCase();
    const target = state.activeTile.word.toLowerCase();
    const okPrefix = target.startsWith(g.trim());
    state.activeTile.el.style.boxShadow = okPrefix
      ? "0 0 16px rgba(33,208,122,.55)"
      : "0 0 14px rgba(208,33,33,.55)";
  }
});

/* Keep input focused while running (handy on desktop too) */
window.addEventListener('keydown', ()=>{
  if(state?.running && document.activeElement !== typed){
    typed.focus({preventScroll:true});
  }
});
</script>
</body>
</html>
