<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GSU Charge Run</title>
  <link rel="icon" href="GSU_LOGO.png" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
      min-height: 100vh;
    }
    #pageWrapper {
      transform: scale(0.75);
      transform-origin: top center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header h1 {
      font-size: 3rem;
      color: #e60023;
    }
    header h2 {
      font-size: 1.5rem;
      color: white;
      margin-top: -10px;
      text-align: center;
    }
    #hud {
      display: flex;
      justify-content: center;
      gap: 25px;
      flex-wrap: wrap;
      margin-bottom: 15px;
      font-size: 1.2rem;
    }
  
    #gameCanvas {
      display: grid;
      grid-template-columns: repeat(20, 48px);
      grid-template-rows: repeat(20, 48px);
      border: 3px solid #e60023;
      box-shadow: 0 0 20px #e60023cc;
      background-image:
        linear-gradient(to right, rgba(255, 255, 255, 0.08) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.08) 1px, transparent 1px);
      background-size: 48px 48px;
      margin-bottom: 20px;
    }
    .grid-cell {
      width: 48px;
      height: 48px;
      position: relative;
      overflow: visible;
    }
    .grid-cell div {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .controller {
      background-image: url('GSU_LOGO.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      z-index: 3;
    }
    .battery::after {
      content: 'üîã';
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      width: 100%;
      text-align: center;
    }
    .hazard::after {
      content: 'üî•';
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      width: 100%;
      text-align: center;
    }
    .reverse-surge::after {
      content: 'üîÑ';
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      width: 100%;
      text-align: center;
    }
    .trapped-fire {
    background-color: #e60023;
    border: 1px solid white;
    box-shadow: 0 0 3px white, 0 0 6px #e60023;
    animation: gsuPulse 1s infinite;
    transform: scale(0.15);
    border-radius: 2px;
    z-index: 1;
  }




  @keyframes gsuPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }

    #startGameBtn {
      padding: 12px 28px;
      font-size: 1.2rem;
      background-color: #e60023;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 0 10px #e60023cc;
    }
    footer {
      margin-top: 30px;
      font-size: 0.9em;
      color: #666;
    }
    .controller.surge-mode {
    animation: gsuGlitch 0.25s infinite steps(1);
    background-image: none;
    background-color: white;
    z-index: 3;
    box-shadow: 0 0 12px white, 0 0 20px #e60023;
  }


@keyframes gsuGlitch {
  0%   { background-color: white; }
  25%  { background-color: #e60023; } /* GSU Red */
  50%  { background-color: white; }
  75%  { background-color: #e60023; }
  100% { background-color: white; }
}

.trap-box {
  position: absolute;
  background: linear-gradient(45deg, #e60023, #b3001b);
  color: white;
  font-size: 0.9rem;
  font-weight: bold;
  padding: 10px 14px;
  border-radius: 10px;
  border: 2px solid white;
  box-shadow: 0 0 10px white, 0 0 16px #e60023;
  text-align: center;
  text-shadow: 0 0 4px black;
  z-index: 999;
  display: none;
  width: 160px;
}

.trap-box .alert-line {
  font-size: 1rem;
  margin-bottom: 4px;
}

.trap-box .countdown-line {
  font-size: 0.95rem;
  color: #ffff00;
}

.trap-left {
  top: 50%;
  left: 20px;
  transform: translateY(-50%);
}

.trap-right {
  top: 50%;
  right: 20px;
  transform: translateY(-50%);
}


  </style>
</head>
<body>
  <!-- üîÑ GSU Trap Alert Boxes - Left & Right -->
<div class="trap-box trap-left">
  <div class="alert-line">üî• Fires Trapped!</div>
  <div class="countdown-line">‚è±Ô∏è <span class="countdown">10s</span></div>
</div>
<div class="trap-box trap-right">
  <div class="alert-line">üî• Fires Trapped!</div>
  <div class="countdown-line">‚è±Ô∏è <span class="countdown">10s</span></div>
</div>

 <div id="pageWrapper">
  <header>
    <h1>GSU DATA SURGE</h1>
    <h2>CONTROLLER CORE</h2>
  </header>

  <div id="hud">
    <span id="goalText">üîã Collect: 0 / 10</span>
    <span>üî• Avoid 20 fires</span>
    <span id="timer">‚è±Ô∏è Time Left: 30</span>
    <span id="powerBar">Surge power: ‚ö°0</span>
    <span id="lives">Life Count: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
    <span id="surgeLevel">Surge Level: 0</span>
    <span>üîÑ Grab for Reverse Surge Mode!</span>
  </div>

  <div id="gameWrapper" style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
    <!-- GAME CANVAS -->
    <div id="gameCanvas"></div>
  </div>

  <!-- ‚úÖ Mobile Controls (ONLY ONCE, BELOW the gameCanvas) -->
  <div id="mobileControls" style="display: none; margin: 20px 0;">
    <div style="display: flex; justify-content: center;">
      <button class="dpad" onclick="moveController('ArrowUp')">‚¨ÜÔ∏è</button>
    </div>
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 5px;">
      <button class="dpad" onclick="moveController('ArrowLeft')">‚¨ÖÔ∏è</button>
      <button class="dpad" onclick="moveController('ArrowDown')">‚¨áÔ∏è</button>
      <button class="dpad" onclick="moveController('ArrowRight')">‚û°Ô∏è</button>
    </div>
  </div>

  <button id="startGameBtn">‚ñ∂Ô∏è Start GSU Charge Run</button>
  <footer>Built for GameSync Union ‚Äî GSU Charge Run‚Ñ¢</footer>
</div>


  <script>
  const canvas = document.getElementById("gameCanvas");
  const startBtn = document.getElementById("startGameBtn");
  const timerDisplay = document.getElementById("timer");
  const livesDisplay = document.getElementById("lives");
  const goalText = document.getElementById("goalText");
  const powerBar = document.getElementById("powerBar");
  const surgeLevelDisplay = document.getElementById("surgeLevel");

  const rows = 20, cols = 20;
  let controllerPos = { x: 10, y: 10 };
  let batteryPositions = [];
  let firePositions = [];
  let reverseSurgeTiles = [];
  let trappedFires = [];
  let collectedBatteries = 0;
  let lives = 3;
  let timer = 30;
  let level = 0;
  let gameInterval, moveInterval;
  let isTimerExpired = false;
  let surgeActive = false;

  function createGrid() {
    canvas.innerHTML = "";
    for (let i = 0; i < rows * cols; i++) {
      const cell = document.createElement("div");
      cell.classList.add("grid-cell");
      canvas.appendChild(cell);
    }
  }

  function getIndex(x, y) {
    return y * cols + x;
  }

  function render() {
    const cells = canvas.querySelectorAll(".grid-cell");
    cells.forEach(cell => cell.innerHTML = "");

    const controller = document.createElement("div");
    controller.classList.add("controller");
    cells[getIndex(controllerPos.x, controllerPos.y)].appendChild(controller);

    batteryPositions.forEach(pos => {
      const el = document.createElement("div");
      el.classList.add("battery");
      cells[getIndex(pos.x, pos.y)].appendChild(el);
    });

    firePositions.forEach(pos => {
      const el = document.createElement("div");
      el.classList.add("hazard");
      cells[getIndex(pos.x, pos.y)].appendChild(el);
    });

    trappedFires.forEach(pos => {
      const el = document.createElement("div");
      el.classList.add("trapped-fire");
      cells[getIndex(pos.x, pos.y)].appendChild(el);
    });

    reverseSurgeTiles.forEach(pos => {
      const el = document.createElement("div");
      el.classList.add("reverse-surge");
      cells[getIndex(pos.x, pos.y)].appendChild(el);
    });

    goalText.textContent = `üîã Collect: ${collectedBatteries} / ${10 + level * 2}`;
    livesDisplay.innerHTML = `Life Count: ${"‚ù§Ô∏è".repeat(lives)}`;
  }

  function getRandomUniquePositions(count, exclude = []) {
    const positions = [];
    while (positions.length < count) {
      const pos = {
        x: Math.floor(Math.random() * cols),
        y: Math.floor(Math.random() * rows)
      };
      const key = `${pos.x},${pos.y}`;
      if (
        !exclude.some(e => `${e.x},${e.y}` === key) &&
        !positions.some(e => `${e.x},${e.y}` === key)
      ) {
        positions.push(pos);
      }
    }
    return positions;
  }

  function moveItemsRandomly(list) {
    return list.map(pos => {
      const directions = [
        { x: 0, y: -1 }, { x: 0, y: 1 },
        { x: -1, y: 0 }, { x: 1, y: 0 }
      ];
      const dir = directions[Math.floor(Math.random() * directions.length)];
      const newX = Math.max(0, Math.min(cols - 1, pos.x + dir.x));
      const newY = Math.max(0, Math.min(rows - 1, pos.y + dir.y));
      return { x: newX, y: newY };
    });
  }

  function spawnLevel() {
    const batteriesNeeded = 10 + level * 2;
    const firesNeeded = 20 + level * 2;
    const exclude = [controllerPos];
    batteryPositions = getRandomUniquePositions(batteriesNeeded, exclude);
    firePositions = getRandomUniquePositions(firesNeeded, [...exclude, ...batteryPositions]);
    reverseSurgeTiles = getRandomUniquePositions(2, [...exclude, ...batteryPositions, ...firePositions]);
    trappedFires = [];
    collectedBatteries = 0;
    timer = 30 + level * 5;
    isTimerExpired = false;
    surgeActive = false;
    render();
  }

  function startTimer() {
  clearInterval(gameInterval);
  clearInterval(moveInterval);

  gameInterval = setInterval(() => {
    if (!isTimerExpired && !surgeActive) {
      timer--;
      timerDisplay.textContent = `‚è±Ô∏è Time Left: ${timer}`;
      if (timer <= 0) {
        isTimerExpired = true;
        loseLife();
      }
    }
  }, 1000);

  moveInterval = setInterval(() => {
    batteryPositions = moveItemsRandomly(batteryPositions);
    reverseSurgeTiles = moveItemsRandomly(reverseSurgeTiles);
    if (!surgeActive) {
      firePositions = moveItemsRandomly(firePositions);
    }
    checkCollision();
  }, 1000);
}


  function loseLife() {
    lives--;
    if (lives <= 0) {
      clearInterval(gameInterval);
      clearInterval(moveInterval);
      alert("Game Over!");
    } else {
      spawnLevel();
      startTimer();
    }
  }

function activateReverseSurge() {
  surgeActive = true;
  trappedFires = [...firePositions];
  firePositions = [];

  const boxes = document.querySelectorAll('.trap-box');
  boxes.forEach(box => {
    box.style.display = "block";
    box.querySelector(".countdown").textContent = "10s";
  });

  const cells = canvas.querySelectorAll(".grid-cell");
  const controllerCell = cells[getIndex(controllerPos.x, controllerPos.y)];
  const controllerDiv = controllerCell?.querySelector(".controller");
  if (controllerDiv) controllerDiv.classList.add("surge-mode");

  let freezeCounter = 10;
  const freezeInterval = setInterval(() => {
    freezeCounter--;

    boxes.forEach(box => {
      box.querySelector(".countdown").textContent = `${freezeCounter}s`;
    });

    if (freezeCounter <= 0) {
      clearInterval(freezeInterval);
      boxes.forEach(box => box.style.display = "none");

      surgeActive = false;
      firePositions = [...firePositions, ...trappedFires];
      trappedFires = [];

      if (controllerDiv) controllerDiv.classList.remove("surge-mode");
    }

    render();
  }, 1000);
}



  function checkCollision() {
    let levelUpTriggered = false;

    // Collect battery
    batteryPositions = batteryPositions.filter(pos => {
      if (pos.x === controllerPos.x && pos.y === controllerPos.y) {
        collectedBatteries++;
        return false;
      }
      return true;
    });

    // Activate üîÑ
    reverseSurgeTiles = reverseSurgeTiles.filter(pos => {
      if (pos.x === controllerPos.x && pos.y === controllerPos.y) {
        activateReverseSurge();
        return false;
      }
      return true;
    });

    // Trap fires during surge
    trappedFires = trappedFires.filter(pos => {
      if (pos.x === controllerPos.x && pos.y === controllerPos.y) {
        return false; // collected into trap
      }
      return true;
    });

    // Check if fire hit
    firePositions.forEach(pos => {
      if (pos.x === controllerPos.x && pos.y === controllerPos.y && !isTimerExpired) {
        isTimerExpired = true;
        loseLife();
      }
    });

    if (collectedBatteries >= 10 + level * 2) {
      level++;
      if (level >= 5) {
        clearInterval(gameInterval);
        clearInterval(moveInterval);
        alert("FULL SYNC COMPLETE! You win!");
        return;
      }
      levelUpTriggered = true;
    }

    render();

    if (levelUpTriggered) {
      powerBar.textContent = `Surge power: ‚ö°${level}`;
      surgeLevelDisplay.textContent = `Surge Level: ${level}`;
      spawnLevel();
      startTimer();
    }
  }

  document.addEventListener("keydown", e => {
    e.preventDefault();
    let moved = false;
    if (e.key === "ArrowUp" && controllerPos.y > 0) controllerPos.y--, moved = true;
    if (e.key === "ArrowDown" && controllerPos.y < rows - 1) controllerPos.y++, moved = true;
    if (e.key === "ArrowLeft" && controllerPos.x > 0) controllerPos.x--, moved = true;
    if (e.key === "ArrowRight" && controllerPos.x < cols - 1) controllerPos.x++, moved = true;
    if (moved) checkCollision();
  });

  startBtn.addEventListener("click", () => {
    lives = 3;
    level = 0;
    powerBar.textContent = `Surge power: ‚ö°0`;
    surgeLevelDisplay.textContent = `Surge Level: 0`;
    controllerPos = { x: 10, y: 10 };
    createGrid();
    spawnLevel();
    startTimer();
  });

  createGrid();
  function moveController(key) {
  let moved = false;
  if (key === "ArrowUp" && controllerPos.y > 0) controllerPos.y--, moved = true;
  if (key === "ArrowDown" && controllerPos.y < rows - 1) controllerPos.y++, moved = true;
  if (key === "ArrowLeft" && controllerPos.x > 0) controllerPos.x--, moved = true;
  if (key === "ArrowRight" && controllerPos.x < cols - 1) controllerPos.x++, moved = true;
  if (moved) checkCollision();
}

// üëá Automatically show mobile controls on phones/tablets
if (window.innerWidth <= 768) {
  document.getElementById("mobileControls").style.display = "block";
}

</script>
</body>
</html>
