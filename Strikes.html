<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GSU Command Strike ‚Äî Versus</title>
<link rel="icon" href="GSU_LOGO.png" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
<style>
  :root{ --gsu-red:#e60023; --bg:#0c0d0f; --fg:#fff; --muted:#c7c7c7 }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:'Orbitron',sans-serif; background:var(--bg); color:var(--fg);
    min-height:100svh; display:flex; flex-direction:column; align-items:center; gap:14px; padding:16px;
    -webkit-text-size-adjust:100%;
  }

  header{display:flex; flex-direction:column; align-items:center; gap:8px}
  nav{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
  nav a{color:#fff; text-decoration:none; background:var(--gsu-red); padding:.55rem .9rem; border-radius:12px; font-weight:700}

  .frame{
    width:min(980px, 96vw);
    border:3px solid var(--gsu-red); border-radius:16px; padding:14px;
    box-shadow:0 0 18px #e60023cc, inset 0 0 18px #e6002326;
    background:linear-gradient(#0a0a0f,#000);
  }
  h1{margin:6px 0 6px 6px}
  .topbar{display:flex; align-items:center; justify-content:center; gap:10px; flex-wrap:wrap; margin:6px 0 10px}
  .chip{background:#1a1b20; border:1px solid #2b2d35; border-radius:12px; padding:6px 10px}
  .scoreline{text-align:center; opacity:.9}

  /* Player blocks */
  .vs-grid{display:grid; grid-template-columns:1fr; gap:14px}
  @media (min-width:760px){ .vs-grid{grid-template-columns:1fr 1fr} }

  .card{
    background:#0f1016; border:1px solid #2a2d36; border-radius:14px; padding:12px; position:relative;
    box-shadow:inset 0 0 0 1px #12131a;
  }
  .title{display:flex; align-items:center; justify-content:center; gap:8px; letter-spacing:1px; margin-bottom:8px}
  .hud{display:flex; gap:8px; flex-wrap:wrap; justify-content:center; font-size:.95rem; margin-bottom:8px}
  .pill{background:#141620; border:1px solid #303342; border-radius:10px; padding:6px 10px}
  .pill strong{color:var(--gsu-red)}

  /* Strike stage */
  .stage{
    position:relative; height:180px; border:1px solid #2b2d36; border-radius:12px;
    background:#0a0b10; overflow:hidden; margin-top:8px;
  }
  .pattern{display:flex; gap:8px; justify-content:center; padding:8px}
  .token{padding:8px 10px; border-radius:10px; background:#171923; border:1px solid #2c2f3c}
  .token.pending{outline:2px solid #ffae00}
  .token.ok{outline:2px solid #29d07a}
  .token.bad{outline:2px solid #d02121}

  /* Winner badge appears INSIDE the stage of the winner */
  .winner-badge{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    background:rgba(255,255,255,.08); border:2px solid #fff; border-radius:14px;
    padding:10px 16px; font-weight:800; letter-spacing:1px; text-shadow:0 0 10px rgba(255,255,255,.35);
    box-shadow:0 0 18px rgba(230,0,35,.35);
    opacity:0; pointer-events:none;
  }
  .winner-badge.show{animation:pop .2s ease-out forwards, fadeOut .9s ease .9s forwards}
  @keyframes pop{from{transform:translate(-50%,-50%) scale(.85); opacity:0}to{transform:translate(-50%,-50%) scale(1); opacity:1}}
  @keyframes fadeOut{to{opacity:0}}

  /* D-Pad & buttons */
  .controls{margin-top:10px; display:grid; grid-template-columns:repeat(3,64px); gap:8px; justify-content:center; align-items:center; user-select:none}
  .key{width:64px; height:64px; border-radius:12px; background:#161823; border:1px solid #2f3240; display:flex; align-items:center; justify-content:center; font-size:1.2rem; cursor:pointer; box-shadow:0 0 8px rgba(255,255,255,.05)}
  .key:active{filter:brightness(1.2)}

  .row{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:8px}
  .btn{border:none; background:var(--gsu-red); color:#fff; padding:10px 16px; border-radius:10px; cursor:pointer; box-shadow:0 0 10px #e60023aa; font-weight:700}
  .btn:disabled{opacity:.6; cursor:not-allowed}

  footer{opacity:.7; font-size:.85rem; text-align:center; margin-top:10px}
</style>
</head>
<body>
  <header>
    <img src="GSU_LOGO.png" alt="GSU" style="max-width:96px" />
    <div>GAMESYNC UNION</div>
    <nav><a href="index.html">Home</a></nav>
  </header>

  <section class="frame" id="frame">
    <h1>GSU COMMAND STRIKE ‚Äî VERSUS</h1>

    <div class="topbar">
      <div class="chip">Difficulty: <strong id="diffName">Easy</strong></div>
      <div class="scoreline">Score ‚Äî You: <strong id="youScore">0</strong> | CPU: <strong id="cpuScore">0</strong> | Ties: <strong id="ties">0</strong> / <strong id="maxRounds">12</strong></div>
    </div>

    <div class="vs-grid">
      <!-- YOU -->
      <div class="card" id="youCard">
        <div class="title">üßë‚Äçüíª YOU</div>
        <div class="hud">
          <div class="pill">Round <strong id="youRound">1</strong>/12</div>
          <div class="pill">Time <strong id="youTime">0</strong>ms</div>
          <div class="pill">Combo <strong id="youCombo">0</strong></div>
          <div class="pill">Progress <strong id="youProg">0</strong>%</div>
          <div class="pill">Hits <strong id="youHits">0</strong></div>
        </div>
        <div class="pattern" id="youPattern"></div>
        <div class="stage">
          <div class="winner-badge" id="youWinBadge">YOU WIN ‚≠ê</div>
        </div>
      </div>

      <!-- CPU -->
      <div class="card" id="cpuCard">
        <div class="title">ü§ñ CPU</div>
        <div class="hud">
          <div class="pill">Round <strong id="cpuRound">1</strong>/12</div>
          <div class="pill">Time <strong id="cpuTime">0</strong>ms</div>
          <div class="pill">Combo <strong id="cpuCombo">0</strong></div>
          <div class="pill">Progress <strong id="cpuProg">0</strong>%</div>
          <div class="pill">Hits <strong id="cpuHits">0</strong></div>
        </div>
        <div class="pattern" id="cpuPattern"></div>
        <div class="stage">
          <div class="winner-badge" id="cpuWinBadge">CPU WINS ü§ñ</div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls" aria-label="D-Pad">
      <div></div><div class="key" data-sym="‚Üë">‚Üë</div><div></div>
      <div class="key" data-sym="‚Üê">‚Üê</div><div class="key" data-sym="‚Üì">‚Üì</div><div class="key" data-sym="‚Üí">‚Üí</div>
    </div>
    <div class="row">
      <button class="btn" id="start">‚ñ∂ Start Drill</button>
      <button class="btn" id="next" disabled>‚è≠ Next Pattern</button>
      <button class="btn" id="restart" disabled>üîÅ Restart</button>
    </div>

    <footer>Built for GameSync Union ‚Äî GSU Command Strike‚Ñ¢</footer>
  </section>

<script>
/* ---------- Game setup ---------- */
const DIR = ["‚Üë","‚Üì","‚Üê","‚Üí"];
const MAX_ROUNDS = 12;
const DIFFICULTY = { Easy:{ cpuAvg:1200, jitter:300 }, Normal:{ cpuAvg:900, jitter:260 }, Hard:{ cpuAvg:700, jitter:220 } };
const activeDiff = DIFFICULTY.Easy;

const els = {
  youPattern: document.getElementById('youPattern'),
  cpuPattern: document.getElementById('cpuPattern'),
  youRound: document.getElementById('youRound'),
  cpuRound: document.getElementById('cpuRound'),
  youTime: document.getElementById('youTime'),
  cpuTime: document.getElementById('cpuTime'),
  youProg: document.getElementById('youProg'),
  cpuProg: document.getElementById('cpuProg'),
  youHits: document.getElementById('youHits'),
  cpuHits: document.getElementById('cpuHits'),
  youCombo: document.getElementById('youCombo'),
  cpuCombo: document.getElementById('cpuCombo'),
  youScore: document.getElementById('youScore'),
  cpuScore: document.getElementById('cpuScore'),
  ties: document.getElementById('ties'),
  maxRounds: document.getElementById('maxRounds'),
  youWinBadge: document.getElementById('youWinBadge'),
  cpuWinBadge: document.getElementById('cpuWinBadge'),
  start: document.getElementById('start'),
  next: document.getElementById('next'),
  restart: document.getElementById('restart'),
};

els.maxRounds.textContent = MAX_ROUNDS;

function pick(a){ return a[Math.floor(Math.random()*a.length)] }
function tokenLengthByRound(r){
  const map = [4,4,5,5,6,6,6,7,7,7,8,8];
  return map[Math.min(MAX_ROUNDS-1, Math.max(0, r-1))];
}
function genPattern(round){
  const len = tokenLengthByRound(round);
  const out = [];
  for (let i=0;i<len;i++){ let t = pick(DIR); if (i && t===out[i-1]) t = pick(DIR.filter(x=>x!==t)); out.push(t); }
  return out;
}

/* ---------- State ---------- */
let state = {
  round:1, youIdx:0, cpuIdx:0,
  youStart:0, youEnd:0, cpuEnd:0,
  youHits:0, cpuHits:0, youCombo:0, cpuCombo:0,
  pattern:[], active:false,
  scoreYou:0, scoreCPU:0, ties:0
};

/* ---------- Rendering ---------- */
function drawPattern(container, pattern, idx){
  container.innerHTML = pattern.map((t,i)=>{
    let cls = "token";
    if (i < idx) cls += " ok";
    else if (i === idx) cls += " pending";
    return `<div class="${cls}">${t}</div>`;
  }).join("");
}
function setHUD(){
  els.youRound.textContent = state.round;
  els.cpuRound.textContent = state.round;
  els.youTime.textContent  = state.youEnd && state.youStart ? (state.youEnd - state.youStart|0) : 0;
  els.cpuTime.textContent  = state.cpuEnd ? (state.cpuEnd - state.youStart|0) : 0;
  els.youHits.textContent  = state.youHits;
  els.cpuHits.textContent  = state.cpuHits;
  els.youCombo.textContent = state.youCombo;
  els.cpuCombo.textContent = state.cpuCombo;
  const pYou = state.pattern.length ? Math.floor(100 * (state.youIdx/state.pattern.length)) : 0;
  const pCPU = state.pattern.length ? Math.floor(100 * (state.cpuIdx/state.pattern.length)) : 0;
  els.youProg.textContent = pYou; els.cpuProg.textContent = pCPU;
  els.youScore.textContent = state.scoreYou; els.cpuScore.textContent = state.scoreCPU; els.ties.textContent = state.ties;
}

/* ---------- Round flow ---------- */
let cpuTimer = null;
function startRound(){
  state.active = true;
  state.pattern = genPattern(state.round);
  state.youIdx = state.cpuIdx = 0;
  state.youHits = state.cpuHits = 0;
  state.youCombo = state.cpuCombo = 0;
  state.youStart = performance.now(); state.youEnd = 0; state.cpuEnd = 0;

  drawPattern(els.youPattern, state.pattern, state.youIdx);
  drawPattern(els.cpuPattern, state.pattern, state.cpuIdx);
  setHUD();

  els.start.disabled = true; els.next.disabled = true; els.restart.disabled = false;

  // Simulate CPU completion time around difficulty average
  const jitter = (Math.random()*2-1) * activeDiff.jitter;
  const cpuFinish = Math.max(300, activeDiff.cpuAvg + jitter);
  cpuTimer = setTimeout(()=>{
    state.cpuIdx = state.pattern.length;
    state.cpuHits = state.pattern.length;
    state.cpuCombo = state.pattern.length;
    state.cpuEnd = performance.now();
    drawPattern(els.cpuPattern, state.pattern, state.cpuIdx);
    setHUD();
    maybeEndRound();
  }, cpuFinish);
}

function endRound(){
  state.active = false;
  clearTimeout(cpuTimer);

  // Winner: compare completion. If both finished, faster wins; otherwise whoever finished wins.
  let winner = null; // 'you' | 'cpu' | 'tie'
  const youFinished = !!state.youEnd;
  const cpuFinished = !!state.cpuEnd;

  if (youFinished && cpuFinished){
    const youTime = state.youEnd - state.youStart;
    const cpuTime = state.cpuEnd - state.youStart;
    if (Math.abs(youTime - cpuTime) < 40){ winner = 'tie'; }
    else winner = (youTime < cpuTime) ? 'you' : 'cpu';
  } else if (youFinished){ winner = 'you'; }
  else if (cpuFinished){ winner = 'cpu'; }
  else { winner = 'tie'; }

  // üî¥ CHANGE: show winner badge INSIDE the winner‚Äôs stage
  if (winner === 'you'){
    els.youWinBadge.classList.add('show');
    setTimeout(()=> els.youWinBadge.classList.remove('show'), 1200);
    state.scoreYou++;
  } else if (winner === 'cpu'){
    els.cpuWinBadge.classList.add('show');
    setTimeout(()=> els.cpuWinBadge.classList.remove('show'), 1200);
    state.scoreCPU++;
  } else {
    // show both small tie flashes if you like, or ignore
    state.ties++;
  }

  setHUD();

  if (state.round >= MAX_ROUNDS){
    els.start.disabled = false; els.start.textContent = "üîÅ New Match";
    els.next.disabled = true;
  } else {
    els.next.disabled = false;
  }
}

function maybeEndRound(){
  const youDone = state.youIdx >= state.pattern.length;
  const cpuDone = state.cpuIdx >= state.pattern.length;
  if (youDone){
    if (!state.youEnd) state.youEnd = performance.now();
  }
  if (cpuDone && !state.cpuEnd) state.cpuEnd = performance.now();

  drawPattern(els.youPattern, state.pattern, state.youIdx);
  drawPattern(els.cpuPattern, state.pattern, state.cpuIdx);
  setHUD();

  if (youDone || cpuDone) endRound();
}

function nextRound(){
  state.round++;
  startRound();
}

/* ---------- Input ---------- */
function apply(sym){
  if (!state.active) return;
  const need = state.pattern[state.youIdx];
  if (!need) return;
  if (sym === need){
    state.youHits++; state.youIdx++; state.youCombo++;
  } else {
    state.youCombo = 0;
    // mark current as bad briefly
    const cur = els.youPattern.querySelectorAll('.token')[state.youIdx];
    if (cur){ cur.classList.add('bad'); setTimeout(()=>cur.classList.remove('bad'),150); }
  }
  maybeEndRound();
}

function onKey(e){
  if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(e.key)) e.preventDefault();
  let sym=null;
  if (e.key==="ArrowUp") sym="‚Üë";
  else if (e.key==="ArrowDown") sym="‚Üì";
  else if (e.key==="ArrowLeft") sym="‚Üê";
  else if (e.key==="ArrowRight") sym="‚Üí";
  if (sym) apply(sym);
}
window.addEventListener('keydown', onKey);
document.querySelectorAll('.key[data-sym]').forEach(k=> k.addEventListener('click', ()=>apply(k.getAttribute('data-sym'))));

/* ---------- Buttons ---------- */
els.start.addEventListener('click', ()=>{
  state = { ...state, round:1, scoreYou:0, scoreCPU:0, ties:0 };
  startRound();
});
els.next.addEventListener('click', nextRound);
els.restart.addEventListener('click', ()=>{ startRound(); });

</script>
</body>
</html>
