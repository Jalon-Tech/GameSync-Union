<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GSU Command Strike ‚Äî Split Duel</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
<style>
:root{ --gsu-red:#e60023; --bg:#141416; --fg:#fff; --muted:#babecb; }
html{-webkit-text-size-adjust:100%}
html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--fg);font-family:'Orbitron',sans-serif;}
.header{display:flex;align-items:center;justify-content:center;gap:10px;margin:10px 0 8px}
.header img{max-width:64px;height:auto}
.header .title{letter-spacing:2px;font-size:clamp(1rem,2.6vw,1.12rem)}

.controls{width:min(940px,96vw);margin:0 auto 6px;display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap;color:var(--muted);font-size:.95em}
.select{appearance:none;border:1px solid #35363a;background:#1f1f24;color:#fff;border-radius:8px;padding:6px 10px;font-family:inherit}
.label{opacity:.9}
.score{width:min(940px,96vw);margin:0 auto 10px;text-align:center;color:#fff;font-size:clamp(.95rem,2.6vw,1.05rem)}
.score strong{color:var(--gsu-red)}

.split-container{
  display:flex;width:min(940px,96vw);margin:0 auto;
  min-height:clamp(300px,40vh,420px);height:clamp(320px,46vh,440px);
  border-radius:16px;overflow:hidden;box-shadow:0 2px 26px #470a1230;border:3px solid var(--gsu-red);
  background:linear-gradient(90deg,#1a1a1d 45%, #10101b 55%);
}
.split-side{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:8px 12px 12px;position:relative;min-width:0;min-height:0}
.split-side.left{background:#181820;border-right:2px solid #e6002335}
.split-side.right{background:#191719}
h2{text-align:center;margin:4px 0;font-size:clamp(1rem,2.8vw,1.2rem);letter-spacing:2px}

.stage-outer{
  border:1.5px solid #2a2a3a;border-radius:12px;margin-bottom:8px;
  height:clamp(90px,22vh,140px);background:#18171c;width:100%;position:relative;overflow:hidden;
  display:flex;align-items:center;justify-content:center;
}
.fx{position:absolute;inset:0;pointer-events:none}
.target{position:absolute;font-size:38px;filter:drop-shadow(0 0 8px #fff);transition:transform .26s cubic-bezier(.33,1.2,.68,1)}
.target.hit{filter:drop-shadow(0 0 14px #e60023)}
.controller{position:absolute;width:54px;will-change:transform;filter:drop-shadow(0 0 8px #e6002366)}
.boom{position:absolute;font-size:46px;opacity:0}
.confetti{position:absolute;width:8px;height:12px;will-change:transform;opacity:.96}

/* In-box winner banner */
.stage-banner{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(.9);
  padding:8px 14px;border:2px solid #fff;border-radius:14px;
  background:rgba(230,0,35,.14);text-shadow:0 0 12px rgba(255,255,255,.34);
  font-size:clamp(.95rem,2.8vw,1.15rem);opacity:0;pointer-events:none;
}

.hud{font-size:clamp(.75rem,2.1vw,.96rem);display:flex;gap:8px;margin-bottom:4px;flex-wrap:wrap;justify-content:center}
.pill{background:#222228;border:1px solid #35363a;border-radius:7px;padding:4px 7px;text-align:center;min-width:48px}
.pill strong{color:var(--gsu-red)}

.cmd{min-height:40px;display:flex;justify-content:center;align-items:center;gap:7px;margin-bottom:6px;flex-wrap:wrap}
.token{padding:6px 10px;margin:1px;border-radius:8px;background:#212123;border:1px solid #393a3c;font-size:clamp(.9rem,2.4vw,1rem)}
.token.pending{outline:2px solid #ffae00}
.token.ok{outline:2px solid #29d07a}
.token.bad{outline:2px solid #d02121}

.leader{letter-spacing:1px;margin:0;font-size:clamp(.82rem,2.2vw,.98rem);text-align:center;min-height:1.2em}

.directions{margin:8px auto 6px;display:flex;gap:8px;justify-content:center;width:min(940px,96vw)}
.key{width:52px;height:44px;border-radius:10px;background:#25242b;border:1.2px solid #2a2d33;display:inline-flex;align-items:center;justify-content:center;font-size:1.1rem;cursor:pointer;user-select:none}
.key:active{filter:brightness(1.2)}

.btnRow{display:flex;gap:10px;justify-content:center;margin:10px 0}
.btn{border:none;background:var(--gsu-red);color:#fff;padding:9px 16px;border-radius:9px;cursor:pointer;font-weight:700;font-size:clamp(1rem,2.6vw,1.1rem)}
.btn:disabled{opacity:.55;cursor:not-allowed}

.helper{margin-top:8px;color:var(--muted);font-size:.95em;text-align:center}
footer{opacity:.8;text-align:center;font-size:.83em;margin:14px auto 10px;color:var(--muted)}

@media (max-width:900px){
  .split-container{flex-direction:column;height:auto;min-height:unset}
  .split-side{min-height:148px}
  .stage-outer{height:clamp(86px,24vh,120px)}
}

nav{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
nav a{color:#fff; text-decoration:none; background:var(--gsu-red); padding:.55rem .9rem; border-radius:10px; font-weight:700;}
</style>
</head>
<body>

<div class="header">
  <img src="GSU_LOGO.png" alt="GSU">
  <span class="title">GSU COMMAND STRIKE ‚Äî SPLIT DUEL</span>
</div>

<div class="header">
  <nav><a href="index.html">Home</a></nav>
</div>

<div class="controls">
  <span class="label">Difficulty:</span>
  <select id="difficulty" class="select">
    <option value="easy" selected>Easy</option>
    <option value="normal">Normal</option>
    <option value="hard">Hard</option>
  </select>
</div>

<div class="score">
  Score ‚Äî You: <strong id="score-p">0</strong> | CPU: <strong id="score-c">0</strong> | Ties: <strong id="score-t">0</strong> / 12
</div>

<div class="split-container">
  <div class="split-side left">
    <h2>üë§ YOU</h2>
    <div class="hud" id="hud-player">
      <div class="pill">Round <strong id="p-round">1</strong>/12</div>
      <div class="pill">Time <strong id="p-time">0</strong>ms</div>
      <div class="pill">Combo <strong id="p-streak">0</strong></div>
      <div class="pill">Progress <strong id="p-prog">0</strong>%</div>
      <div class="pill">Hits <strong id="p-hits">0</strong></div>
    </div>
    <div class="cmd" id="p-cmd"></div>

    <div class="stage-outer" id="stage-player">
      <div class="fx" id="fx-player"></div>
      <div class="stage-banner" id="banner-player"></div>
    </div>

    <div id="player-leader" class="leader"></div>
  </div>

  <div class="split-side right">
    <h2>ü§ñ CPU</h2>
    <div class="hud" id="hud-cpu">
      <div class="pill">Round <strong id="c-round">1</strong>/12</div>
      <div class="pill">Time <strong id="c-time">0</strong>ms</div>
      <div class="pill">Combo <strong id="c-streak">0</strong></div>
      <div class="pill">Progress <strong id="c-prog">0</strong>%</div>
      <div class="pill">Hits <strong id="c-hits">0</strong></div>
    </div>
    <div class="cmd" id="c-cmd"></div>

    <div class="stage-outer" id="stage-cpu">
      <div class="fx" id="fx-cpu"></div>
      <div class="stage-banner" id="banner-cpu"></div>
    </div>

    <div id="cpu-leader" class="leader"></div>
  </div>
</div>

<div class="directions">
  <div class="key" data-sym="‚Üë">‚Üë</div>
  <div class="key" data-sym="‚Üê">‚Üê</div>
  <div class="key" data-sym="‚Üì">‚Üì</div>
  <div class="key" data-sym="‚Üí">‚Üí</div>
</div>

<div class="btnRow">
  <button class="btn" id="start">‚ñ∂ Start Drill</button>
  <button class="btn" id="next" disabled>‚è≠ Next Pattern</button>
  <button class="btn" id="restart" disabled>üîÅ Restart</button>
</div>

<div class="helper">Arrows = move. Beat the CPU to win the round!</div>

<footer>Built for GameSync Union ‚Äî GSU Command Strike‚Ñ¢</footer>

<script>
/* -------------------- Constants & helpers -------------------- */
const DIR = ["‚Üë","‚Üì","‚Üê","‚Üí"];
const MAX_ROUNDS = 12;
const BOOM_ICONS = [
  'üí•','‚ú®','‚ö°','üî•','üí£','üéÜ','üéá','üß®','üå©Ô∏è','üåü','‚òÑÔ∏è','üí´',
  'üåã','üåÄ','‚≠ê','üå†','üå™Ô∏è','‚ú¥Ô∏è','‚ú≥Ô∏è','‚ùáÔ∏è','‚ú∫','‚úπ','‚ú∏','‚úª',
  'üåä','‚ùÑÔ∏è','üí®','üå´Ô∏è','üíÄ','üí¢','üî®','ü™ì','üßØ','üèöÔ∏è','ü™®',
  'üí•‚ú®','‚ö°üî•','üéÜüí£','üå©Ô∏èüí•','‚òÑÔ∏è‚ú®','üåã‚ö°','‚≠êüî•','üåÄüí•',
  'üå†‚ö°','üå™Ô∏èüéá','üí´üí£','üß®‚≠ê','üéáüî•','‚ú®üåü','‚ö°‚òÑÔ∏è','üí•üå†',
  'üå©Ô∏è‚ö°','üå™Ô∏èüåä','‚ùÑÔ∏èüí®','üî•üå©Ô∏è','‚òÑÔ∏èüî•','üåä‚ö°','üå´Ô∏èüå™Ô∏è','üåãüí®',
  'üåÄ‚ùÑÔ∏è','üí•üå™Ô∏è','‚ö°üí®','üåä‚òÑÔ∏è','üî•üåÄ','üí•üå´Ô∏è',
  'üí•üíÄ','üí¢üí•','üí£üèöÔ∏è','üß®üî•','‚òÑÔ∏èüíÄ','üí•ü™®','üíÄ‚ö°','üí•üß®',
  'üí•‚ú®‚ö°','üî•üéÜüí£','üå©Ô∏è‚òÑÔ∏è‚≠ê','üí´üåãüî•','üå†üå™Ô∏èüéá',
  'üß®üí•‚ú®','‚ö°üí´üå™Ô∏è','‚òÑÔ∏èüí•üåã','üî•üåü‚ú®','üí£‚ö°üå©Ô∏è',
  'üí•üéÜüí´','üå†‚≠ê‚ö°','üî•üí•üå™Ô∏è','‚ú®üí•üåü','üí´üå†‚ö°',
  'üå©Ô∏è‚ö°üî•','üå™Ô∏èüåäüí®','‚ùÑÔ∏è‚òÑÔ∏è‚ö°','üî•üåãüå™Ô∏è','üåÄüí•‚ö°',
  'üåä‚ùÑÔ∏èüí®','‚òÑÔ∏èüå™Ô∏èüî•','üí•‚ö°üåä','üå´Ô∏èüå™Ô∏èüî•','‚ùÑÔ∏èüåäüåã',
  '‚ö°üî•üåÄ','‚òÑÔ∏èüí•üå™Ô∏è','üåä‚ö°‚ùÑÔ∏è','üåãüî•‚ö°',
  'üí•üí£üíÄüèöÔ∏è','üî•üíÄ‚òÑÔ∏è‚ö°','üí¢üí•üåã‚ö°','üß®üí•üî•üíÄ','üèöÔ∏è‚òÑÔ∏è‚ö°üí•'
];

const $ = (sel)=>document.querySelector(sel);
const $$ = (sel)=>[...document.querySelectorAll(sel)];
const pick = (arr)=>arr[Math.floor(Math.random()*arr.length)];
const rand = (a,b)=>Math.random()*(b-a)+a;

/* Elements */
const pCmd = $("#p-cmd"), cCmd = $("#c-cmd");
const fxP = $("#fx-player"), fxC = $("#fx-cpu");
const stageP = $("#stage-player"), stageC = $("#stage-cpu");
const bannerP = $("#banner-player"), bannerC = $("#banner-cpu");
const startBtn = $("#start"), nextBtn = $("#next"), restartBtn = $("#restart");
const difficultySel = $("#difficulty");
const scoreP = $("#score-p"), scoreC = $("#score-c"), scoreT = $("#score-t");

/* Scoreboard state */
const score = { p:0, c:0, t:0 };
function updateScoreboard(){
  scoreP.textContent = score.p;
  scoreC.textContent = score.c;
  scoreT.textContent = score.t;
}

/* HUD setters */
function setHUD(side, data){
  for(const k in data){
    const el = document.getElementById(`${side}-${k}`);
    if(el) el.textContent = data[k];
  }
}

/* -------------------- FX -------------------- */
function spawnTargetFX(stage, fx, existing=[]) {
  const rect = stage.getBoundingClientRect(), pad = 14, size = 36;
  let x, y, tries = 0;
  do {
    x = rand(pad, rect.width - pad - size);
    y = rand(pad, rect.height - pad - size);
    tries++;
    const overlap = existing.some(t => Math.abs(x - t.x) < size && Math.abs(y - t.y) < size);
    if(tries > 60) break;
    if(!overlap) break;
  } while(true);
  const el = document.createElement('div');
  el.className='target';
  el.style.transform = `translate(${x}px,${y}px)`;
  el.textContent = pick(['üëæ','üòÇ','üòà','ü§°','üôÑ','‚ò†Ô∏è','ü§™','ü§¨','ü§ë','üò¥','üë∫','üêí','ü¶Ö','üê∏','üê∑','üêä','üê∞','üêâ','ü¶ä','üòç','ü•∏','üëª','ü¶Å','ü¶Ñ','üò±','üê¶‚Äçüî•','üê≤','üòé','ü§©','üòò']);
  fx.appendChild(el);
  return {x,y,el};
}

function flyControllerFX(stage, fx, target, cb) {
  const img = document.createElement('img');
  img.src = "GSU_LOGO.png";
  img.className = "controller";
  fx.appendChild(img);
  const tx = target.x, ty = target.y, sx = rand(-40, 6), sy = rand(18, stage.clientHeight - 30);
  const kf = [
    {transform: `translate(${sx}px,${sy}px) scale(1)`},
    {transform: `translate(${(sx + tx)/2}px,${(sy + ty)/2 - 24}px) scale(1.06)`},
    {transform: `translate(${tx}px,${ty}px) scale(1.10)`}
  ];
  img.animate(kf, {duration: 330, easing: 'cubic-bezier(.2,.7,.2,1)', fill:'forwards'}).onfinish = () => {
    setTimeout(() => {
      const boom = document.createElement('div');
      boom.className = "boom";
      boom.textContent = pick(BOOM_ICONS);
      boom.style.transform = `translate(${tx + rand(-6, 6)}px,${ty + rand(-6,6)}px) scale(0.6)`;
      fx.appendChild(boom);
      boom.animate([{opacity:.1},{opacity:1},{opacity:0}], {duration: 300, fill:'forwards'}).onfinish = () => boom.remove();
      confettiFX(stage, fx, tx, ty, 6 + Math.floor(Math.random()*2));
    }, 80);
    target.el.classList.add("hit");
    setTimeout(() => { target.el && target.el.remove(); }, 140);
    cb && cb();
    img.remove();
  };
}

function confettiFX(stage, fx, x, y, n) {
  for(let i=0; i<n; i++) {
    const c = document.createElement("div");
    c.className = "confetti";
    c.style.background = pick(["#e60023","#22cc88","#33aaff","#ffcc33","#dd66ff","#ffffff"]);
    const sx = x + rand(-10,10), sy = y + rand(-7,7), th = stage.clientHeight;
    c.style.transform = `translate(${sx}px,${sy}px) rotate(${rand(0,360)}deg)`;
    fx.appendChild(c);
    c.animate([
      {transform: `translate(${sx}px,${sy}px)`, opacity: 1},
      {transform: `translate(${sx + rand(-38,38)}px,${th + 18}px) rotate(${rand(180,720)}deg)`, opacity: 0.05}
    ], {duration: rand(560,920), easing: "cubic-bezier(.2,.7,.2,1)", fill: "forwards"}).onfinish = () => c.remove();
  }
}

/* -------------------- Difficulty -------------------- */
function getDifficulty(){
  const d = difficultySel.value;
  if(d === "hard")   return { base: 280, min: 180, skip: 0.10, jitter:[30,90], fumble:0.00 };
  if(d === "normal") return { base: 340, min: 220, skip: 0.22, jitter:[50,110], fumble:0.01 };
  return               { base: 420, min: 260, skip: 0.35, jitter:[80,140], fumble:0.05 }; // easy
}
function cpuSpeedByRound(r){
  const d = getDifficulty();
  return Math.max(d.base - (r-1)*8, d.min);
}

/* -------------------- Game core -------------------- */
function tokenLengthByRound(r){ return Math.min(4 + Math.floor((r-1)/2), 10); }
function genPattern(len){ return Array.from({length:len}, ()=> DIR[Math.floor(Math.random()*DIR.length)]); }
function renderTokens(container, arr, index){
  container.innerHTML = "";
  arr.forEach((sym,i)=>{
    const t = document.createElement("div");
    t.className = "token";
    t.textContent = sym;
    if(i < index) t.classList.add("ok");
    else if(i === index) t.classList.add("pending");
    container.appendChild(t);
  });
}
function progressPct(done, total){ return Math.round((done/Math.max(1,total))*100); }

/* In-box banner helpers */
function showInBoxBanner(which, text, duration=1400){
  const el = which === "player" ? bannerP : bannerC;
  if(!el) return;
  el.textContent = text;
  el.style.opacity = 0;
  el.style.transform = "translate(-50%,-50%) scale(.9)";
  el.animate(
    [{opacity:0, transform:"translate(-50%,-50%) scale(.9)"},
     {opacity:1, transform:"translate(-50%,-50%) scale(1)"}],
    {duration:220, easing:"ease-out", fill:"forwards"}
  );
  setTimeout(()=>{
    el.animate(
      [{opacity:1, transform:"translate(-50%,-50%) scale(1)"},
       {opacity:0, transform:"translate(-50%,-50%) scale(.96)"}],
      {duration:360, easing:"ease-in", fill:"forwards"}
    );
  }, duration);
}

let game = null;
function newGame(){
  score.p = 0; score.c = 0; score.t = 0; updateScoreboard();
  startBtn.textContent = "‚ñ∂ Start Drill";
  return {
    round: 1,
    player: { idx:0, hits:0, streak:0, startedAt:0, time:0 },
    cpu:    { idx:0, hits:0, streak:0, startedAt:0, time:0, timer:null },
    pattern: [],
    targetsP: [], targetsC: [],
    done:false
  };
}

/* Pre-spawn targets = number of commands (both sides) */
function populateTargets(len){
  fxP.innerHTML = ""; fxC.innerHTML = "";
  game.targetsP = []; game.targetsC = [];
  for(let i=0;i<len;i++){
    game.targetsP.push(spawnTargetFX(stageP, fxP, game.targetsP));
    game.targetsC.push(spawnTargetFX(stageC, fxC, game.targetsC));
  }
}

function startRound(){
  if(!game) game = newGame();
  game.done = false;
  game.player.idx=0; game.player.streak=0; game.player.hits=0; game.player.time=0;
  game.cpu.idx=0; game.cpu.streak=0; game.cpu.hits=0; game.cpu.time=0;

  const len = tokenLengthByRound(game.round);
  game.pattern = genPattern(len);
  renderTokens(pCmd, game.pattern, game.player.idx);
  renderTokens(cCmd, game.pattern, game.cpu.idx);

  setHUD("p",{round:game.round, time:0, streak:0, prog:0, hits:0});
  setHUD("c",{round:game.round, time:0, streak:0, prog:0, hits:0});
  $("#player-leader").textContent = "";
  $("#cpu-leader").textContent = "";

  populateTargets(len);

  startBtn.disabled = true; nextBtn.disabled = true; restartBtn.disabled = false;

  game.player.startedAt = performance.now();
  game.cpu.startedAt = performance.now();

  startCPU();
}

function endRound(winner){
  game.done = true;
  if(game.cpu.timer){ clearInterval(game.cpu.timer); game.cpu.timer=null; }

  // Update scoreboard
  if(winner === "player") score.p++;
  else if(winner === "cpu") score.c++;
  else score.t++;
  updateScoreboard();

  // Show round result inside both strike areas
  const roundMsg = winner === "player" ? "You win round üèÜ"
                  : winner === "cpu" ? "CPU wins round ü§ñ"
                  : "Round tied ‚öñÔ∏è";
  showInBoxBanner("player", roundMsg, 1300);
  showInBoxBanner("cpu",    roundMsg, 1300);

  // If final round -> show final match result **inside the boxes** too
  const isFinal = (game.round >= MAX_ROUNDS);
  if(isFinal){
    let finalMsg = `Match: You ${score.p} ‚Äì ${score.c} CPU`;
    if(score.p > score.c) finalMsg += " ‚Ä¢ You Win üèÜ";
    else if(score.c > score.p) finalMsg += " ‚Ä¢ CPU Wins ü§ñ";
    else finalMsg += " ‚Ä¢ Tie ‚öñÔ∏è";

    setTimeout(()=>{
      showInBoxBanner("player", finalMsg, 2200);
      showInBoxBanner("cpu",    finalMsg, 2200);
    }, 1100);

    nextBtn.disabled = true;
    startBtn.disabled = false;
    startBtn.textContent = "üîÅ Restart Match";
  } else {
    nextBtn.disabled = false;
    startBtn.disabled = false;
  }

  $("#player-leader").textContent = winner==="player" ? "You were faster!" : "";
  $("#cpu-leader").textContent = winner==="cpu" ? "CPU was faster!" : "";
}

/* -------------------- Player input => boom next emoji -------------------- */
function apply(sym){
  if(!game || game.done) return;
  const expect = game.pattern[game.player.idx];
  if(!DIR.includes(sym)) return;

  if(sym === expect){
    const target = game.targetsP[game.player.idx];
    if(target){
      flyControllerFX(stageP, fxP, target, ()=>{});
    }
    game.player.idx++;
    game.player.hits++;
    game.player.streak++;
    const now = performance.now();
    game.player.time = Math.round(now - game.player.startedAt);

    renderTokens(pCmd, game.pattern, game.player.idx);
    setHUD("p",{
      time:game.player.time,
      streak:game.player.streak,
      prog:progressPct(game.player.idx, game.pattern.length),
      hits:game.player.hits
    });

    if(game.player.idx >= game.pattern.length && !game.done){
      if(game.cpu.idx < game.pattern.length) endRound("player");
      else endRound("draw");
    }
  }else{
    game.player.streak = 0;
    const cur = pCmd.children[game.player.idx];
    if(cur){ cur.classList.add("bad"); setTimeout(()=>cur.classList.remove("bad"), 150); }
  }
}

/* -------------------- CPU logic => boom next emoji -------------------- */
function startCPU(){
  const d = getDifficulty();
  const base = cpuSpeedByRound(game.round);

  const step = ()=> {
    if(game.done) return;
    if(Math.random() < d.skip) return; // hesitation

    const jitter = rand(d.jitter[0], d.jitter[1]);

    setTimeout(()=>{
      if(game.done) return;

      // fumble (Easy/Normal): small chance to lose one step
      if(d.fumble > 0 && Math.random() < d.fumble && game.cpu.idx > 0){
        game.cpu.idx = Math.max(0, game.cpu.idx - 1);
        const cur = cCmd.children[Math.max(0, game.cpu.idx)];
        if(cur){ cur.classList.add("bad"); setTimeout(()=>cur.classList.remove("bad"), 140); }
      } else {
        const target = game.targetsC[game.cpu.idx];
        if(target){
          flyControllerFX(stageC, fxC, target, ()=>{});
        }
        game.cpu.idx++;
        game.cpu.hits++;
        game.cpu.streak++;
      }

      const now = performance.now();
      game.cpu.time = Math.round(now - game.cpu.startedAt);

      renderTokens(cCmd, game.pattern, game.cpu.idx);
      setHUD("c",{
        time:game.cpu.time,
        streak:game.cpu.streak,
        prog:progressPct(game.cpu.idx, game.pattern.length),
        hits:game.cpu.hits
      });

      if(game.cpu.idx >= game.pattern.length && !game.done){
        if(game.player.idx < game.pattern.length) endRound("cpu");
        else endRound("draw");
      }
    }, jitter);
  };

  game.cpu.timer = setInterval(step, base);
}

/* -------------------- Input & Buttons -------------------- */
window.addEventListener("keydown", (e) => {
  if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();
  let sym = null;
  if (e.key === "ArrowUp") sym = "‚Üë";
  else if (e.key === "ArrowDown") sym = "‚Üì";
  else if (e.key === "ArrowLeft") sym = "‚Üê";
  else if (e.key === "ArrowRight") sym = "‚Üí";
  if (sym) apply(sym);
});
$$(".key[data-sym]").forEach(k=> k.addEventListener("click", ()=> apply(k.getAttribute("data-sym")) ));

startBtn.addEventListener("click", ()=>{
  game = newGame();
  startRound();
});
nextBtn.addEventListener("click", ()=>{
  if(!game) return;
  game.round = Math.min(game.round+1, MAX_ROUNDS);
  startRound();
});
restartBtn.addEventListener("click", ()=>{
  if(!game) return;
  startRound();
});

// Changing difficulty resets match on next Start
difficultySel.addEventListener("change", ()=>{
  startBtn.disabled = false;
  nextBtn.disabled = true;
  restartBtn.disabled = true;
  startBtn.textContent = "‚ñ∂ Start Drill";
});
</script>
</body>
</html>
