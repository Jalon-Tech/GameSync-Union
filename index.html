<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GameSync Union</title>
  <link rel="icon" href="GSU_LOGO.png" />
  <link rel="apple-touch-icon" href="GSU_LOGO.png" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --gsu-red:#e60023;
      --black-main:#191818;
      --black-faded:#1F1F1F;
      --white:#fff;
      --ink:#e9e9e9;
      --muted:#bdbdbd;
      --radius:12px;
      --gap:1rem;
      --shadow:0 0 12px rgba(255,255,255,.05);
    }

    /* Auth gating */
    body[data-auth="out"] .auth-required{display:none!important;}
    body[data-auth="in"]  .auth-required{display:block;}

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Roboto,system-ui,-apple-system,Segoe UI,Arial,sans-serif;
      background:var(--black-main);
      color:var(--white);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Page container for sane widths on big screens */
    .page{max-width:1280px; margin-inline:auto; padding-inline:clamp(12px,2.4vw,24px);}

    header{
      background:var(--black-faded);
      position:sticky; top:0; z-index:30;
      border-bottom:1px solid #2a2a2a;
    }
    .header-inner{
      display:flex; align-items:center; justify-content:space-between;
      gap:.75rem; padding:12px clamp(12px,2.4vw,24px);
      max-width:1280px; margin-inline:auto;
    }
    .logo{display:flex; align-items:center; gap:.75rem}
    .logo img{height:48px; width:auto}
    .logo-text{font-family:Montserrat, sans-serif; font-weight:700; letter-spacing:.5px}

    nav{display:flex; flex-wrap:wrap; align-items:center; gap:.8rem}
    nav a{
      color:var(--white); text-decoration:none; font:500 .95rem/1 Roboto,sans-serif;
      padding:.45rem .6rem; border-radius:8px; transition:.25s ease;
    }
    nav a:hover{color:var(--gsu-red); background:#262626}

    .btn{
      background:var(--gsu-red); color:#fff; border:none; cursor:pointer;
      padding:.75rem 1rem; border-radius:10px; font:600 .95rem/1 Montserrat,sans-serif;
      transition:filter .2s ease, transform .15s ease;
    }
    .btn:hover{filter:brightness(.95); transform:translateY(-1px)}

    /* 3-column grid with safe min widths & fluid middle */
    .main-container{
      display:grid; gap:clamp(.9rem,2.2vw,1.5rem);
      grid-template-columns:minmax(240px,1fr) minmax(540px,2.2fr) minmax(240px,1fr);
      padding:clamp(12px,2.4vw,24px);
    }
    @media (max-width:1024px){ .main-container{grid-template-columns:1fr} }

    .box{
      background:var(--black-faded);
      border:1px solid #2b2b2b;
      border-radius:var(--radius);
      padding:clamp(.9rem,2.2vw,1.25rem);
      box-shadow:var(--shadow);
      transition:transform .25s ease, box-shadow .25s ease, border-color .25s ease;
    }
    .box:hover{ transform:translateY(-3px); border-color:var(--gsu-red); box-shadow:0 6px 18px rgba(230,0,35,.25), var(--shadow); }
    .box h2{
      margin:0 0 .6rem; font:700 clamp(1rem,2.3vw,1.25rem)/1.1 Montserrat,sans-serif;
      color:#fff; text-shadow:0 0 6px rgba(255,0,55,.25);
    }

    .input-field{
      width:100%; padding:.7rem .8rem; border-radius:9px; border:1px solid #333;
      background:#262626; color:#fff; margin-bottom:.6rem;
    }

    /* Profile header & stats */
    #profile-box{
      background:linear-gradient(180deg,#1e1e1e,#242424);
      border:1px solid #333; box-shadow:0 0 10px rgba(230,0,35,.18);
    }
    .profile-header{
      text-align:center; margin-bottom:.25rem;
    }
    .profile-meta{
      display:grid; gap:.4rem; justify-items:center; margin-bottom:.6rem;
      color:var(--ink);
      font-size:.95rem;
    }
    .profile-meta span{display:inline-flex; align-items:center; gap:.4rem}

    /* Replaced old red â€œstat boxesâ€ with clean rows that never duplicate */
    .stats-list{
      display:grid; gap:.6rem;
      grid-template-columns:1fr;
    }
    @media (min-width:640px){
      .stats-list{ grid-template-columns:repeat(2, 1fr); }
    }
    @media (min-width:980px){
      .stats-list{ grid-template-columns:repeat(3, 1fr); }
    }
    .stat-row{
      display:flex; align-items:center; gap:.6rem;
      background:#232323; border:1px solid #343434; border-left:4px solid var(--gsu-red);
      padding:.7rem .8rem; border-radius:10px; color:#eaeaea;
      min-height:44px;
    }
    .stat-row .icon{opacity:.9}

    /* Favorite images â€” responsive grid (falls back to row on very narrow) */
    #fav-images{
      display:grid; gap:.8rem; margin-top:.8rem;
      grid-template-columns:repeat(auto-fit, minmax(180px,1fr));
    }
    .profile-fav-img{
      width:100%; height:clamp(120px, 22vw, 220px);
      object-fit:cover; border-radius:12px; background:#111; border:1px solid #2b2b2b;
      transition:transform .25s ease, box-shadow .25s ease;
    }
    .profile-fav-img:hover{ transform:scale(1.02); box-shadow:0 0 12px rgba(230,0,35,.28); }

    .label-muted{color:#cfcfcf; font-size:.92rem; margin-top:.4rem}

    /* Retro + knowledge + sync card */
    .match-review-style h2{
      color:var(--gsu-red); border-bottom:2px solid var(--gsu-red);
      padding-bottom:.5rem; text-shadow:0 0 8px rgba(230,0,35,.35);
    }
    #character-sync-box{
      border:1px solid #333; border-left:4px solid var(--gsu-red);
      background:#1a1a1a; border-radius:12px; padding:12px;
    }
    #character-image{
      width:140px; height:140px; object-fit:contain; background:#000;
      border:1px solid #444; border-radius:10px;
    }
    #character-desc{ color:#cfcfcf; font-size:.92rem; max-width:280px }

    /* Spotlight */
    #spotlight3{ background:linear-gradient(180deg,#1f1f1f,#242424); border:1px solid #2e2e2e }
    #fav-game-updates{
      display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      margin-top:.8rem;
    }
    .spotlight-video{
      border:1px solid #333; border-radius:12px; background:#262626; padding:12px;
    }
    .spotlight-video iframe{ width:100%; height:clamp(180px, 28vw, 320px); border:0; border-radius:10px }

    /* Footer */
    footer{ background:var(--black-faded); border-top:1px solid #2b2b2b; margin-top:40px }
    .platform-icons{ display:flex; justify-content:center; gap:18px; padding:14px 0 6px }
    .platform-icons img{ height:28px; opacity:.9 }

    /* Small helpers */
    .row{display:flex; gap:.6rem; align-items:center}
    .center{text-align:center}
    .mt-05{margin-top:.5rem}
    .mt-10{margin-top:1rem}

    /* Subtle flash used on image updates only (remove heavy glow) */
    @keyframes softFlash{0%{box-shadow:0 0 0 rgba(230,0,35,0)}50%{box-shadow:0 0 14px rgba(230,0,35,.35)}100%{box-shadow:0 0 0 rgba(230,0,35,0)}}
    .update-flash-img{animation:softFlash 900ms ease}
  </style>
</head>

<body data-auth="out">
  <header>
    <div class="header-inner">
      <div class="logo">
        <img src="GSU_LOGO.png" alt="GSU Logo"/>
        <div class="logo-text">GAMESYNC UNION</div>
      </div>
      <nav>
        <a href="index.html">Home</a>
        <a href="games.html">Games</a>
        <a href="trophies.html">GSU Hall of Trophies & Achievements</a>
        <a href="art.html">Art</a>
        <a href="game-guides.html">GSU Gameplay Center</a>
        <a href="uploads.html">GSU Player Lounge</a>
      </nav>
      <button id="logoutBtn" class="btn" style="background:#777">Log Out</button>
    </div>
  </header>

  <div class="page">
    <div class="main-container">
      <!-- LEFT -->
      <aside>
        <div class="box" id="auth-box">
          <h2>Sign in</h2>
          <input type="text" class="input-field" placeholder="Email"/>
          <input type="text" class="input-field" placeholder="Username"/>
          <input type="password" class="input-field" placeholder="Password"/>
          <button class="btn" id="signInBtn">Sign In</button>
          <p class="center mt-05">
            Not a GSU member?
            <button class="btn mt-05" id="createAccountBtn" style="padding:.45rem .8rem; font-size:.9rem">Create your GSU account</button>
          </p>
        </div>

        <div class="box match-review-style">
          <h2>ğŸ•¹ï¸ Retro Game Flashback</h2>
          <p style="color:#cfcfcf; font-size:.95rem" class="mt-05">Step back into the early days of gaming. One random flashback every click.</p>
          <div class="mt-10">
            <div class="row" style="justify-content:space-between">
              <div style="font-weight:700; color:var(--gsu-red)">Retroverse</div>
            </div>
            <div id="retro-fact" style="margin-top:.4rem; max-height:88px; overflow:auto; color:#ddd">Loading factâ€¦</div>
            <button class="btn mt-10" onclick="loadRetroFact()" style="font-size:.9rem">ğŸ•¹ï¸ Spin the Retro Wheel</button>
          </div>
        </div>

        <div class="box match-review-style">
          <h2>ğŸ® GSU Character Sync-Up</h2>
          <p style="color:#cfcfcf; font-size:.95rem" class="mt-05">Choose your platform to reveal which legend is synced with your GSU energy.</p>
          <label class="mt-05">ğŸ•¹ï¸ Platform</label>
          <select id="platform-select" class="input-field">
            <option value="">-- Choose Platform --</option>
            <option value="PlayStation">PlayStation</option>
            <option value="PC">PC</option>
            <option value="Xbox">Xbox</option>
            <option value="Nintendo">Nintendo</option>
          </select>
          <div id="no-character-msg" class="center" style="color:#ff7474; font-size:.92rem">No Video Game Character in Sync.</div>
          <div id="character-role" class="center mt-05" style="font-weight:700"></div>
          <div id="character-sync-box" class="mt-05">
            <div class="row" style="flex-wrap:wrap; justify-content:center">
              <img id="character-image" src="GSU_LOGO.png" alt="Character"/>
              <div id="character-desc">Choose your platform to reveal your synced legend.</div>
            </div>
          </div>
        </div>
      </aside>

      <!-- CENTER -->
      <main>
        <div class="box center">
          <h2>Welcome to GameSync Union</h2>
          <p class="mt-05">No pause. No kink. Just raw sync â€” GameSync Union is where gamers link.</p>
          <button class="btn mt-10" onclick="window.location.href='about.html'">
            ğŸ“˜ğŸ® The Full Breakdown: GameSync Union Explained
          </button>
        </div>

        <!-- Profile -->
        <div class="box auth-required" id="profile-box">
          <div class="profile-header">
            <h2>Your Profile</h2>
          </div>
          <div class="profile-meta">
            <span class="username-info">ğŸ‘¤ Username: â€”</span>
            <span class="platform-info">ğŸ”¹ Platform: â€”</span>
          </div>

          <!-- Clean responsive stats -->
          <div class="stats-list" aria-live="polite">
            <div id="fav-games"   class="stat-row"><span class="icon">ğŸ”¥</span><span>Favorite Games â€”</span></div>
            <div id="games-played" class="stat-row"><span class="icon">ğŸ®</span><span>Number Of Games Played â€”</span></div>
            <div id="trophy-stats" class="stat-row"><span class="icon">ğŸ†</span><span>Trophy Stats â€”</span></div>
          </div>

          <div class="label-muted mt-10">ğŸ® Synced Game Covers â€“ Pulled from Your Top 3 Favorites</div>
          <div id="fav-images"></div>

          <div class="center mt-10">
            <button onclick="openEditModal()" class="btn" style="max-width:240px">Update GSU Profile</button>
          </div>
        </div>

        <input type="text" class="input-field" placeholder="Search guides, uploads, art, users, or trophiesâ€¦"/>

        <!-- Stats (sitewide) -->
        <div class="box auth-required" id="statsCard">
          <h2 class="center">ğŸ”¥ Statline Supreme: All Union. All Synced.</h2>
          <div class="livewire-stats">
            <div class="stat-row"><span class="icon">ğŸ‘¥</span> Total GSU Members: <span id="totalMembers" style="margin-left:.4rem">_</span></div>
            <div class="stat-row"><span class="icon">ğŸ†•</span> New Members This Week: <span id="newMembers" style="margin-left:.4rem">_</span></div>
            <div class="stat-row"><span class="icon">ğŸ“¹</span> Videos Shared: <span id="videoUploads" style="margin-left:.4rem">_</span></div>
            <div class="stat-row"><span class="icon">ğŸ¨</span> Fan Art Pieces: <span id="fanArt" style="margin-left:.4rem">_</span></div>
            <div class="stat-row"><span class="icon">ğŸ†</span> Trophies Earned: <span id="trophies" style="margin-left:.4rem">_</span></div>
            <div class="stat-row"><span class="icon">ğŸ¥Š</span> Combo Guides: <span id="combos" style="margin-left:.4rem">_</span></div>
            <div class="stat-row"><span class="icon">ğŸ“Š</span> Total Poll Votes: <span id="pollVotes" style="margin-left:.4rem">_</span></div>
          </div>
        </div>

        <!-- Union Watch -->
        <div class="box">
          <h2 class="center">ğŸ”¥ Made the Union Watch</h2>
          <p class="center" style="color:#d7d7d7">When the Union highlights you â€” it means something. Real gameplay earns the light.</p>
          <div id="unionWatch" class="showoff-card" style="flex-direction:column; align-items:center;">
            <div id="unionWatchMedia" style="width:100%; max-width:760px"></div>
            <div class="showoff-info center">
              <h3 id="unionWatchTitle" style="color:var(--gsu-red)">Loading featured clipâ€¦</h3>
              <p id="unionWatchCaption"></p>
            </div>
          </div>
          <div class="center mt-10">
            <button class="btn" onclick="window.location.href='uploads.html'">See Why Everyoneâ€™s Talking</button>
          </div>
        </div>

        <!-- Trophy -->
        <div class="box">
          <h2 class="center">ğŸ‘‘ One Trophy. One Flex.</h2>
          <div class="certified-moment">
            <img id="certifiedImg" src="GSU_LOGO.png" alt="Moment" class="certified-img"/>
            <p id="certifiedCaption" class="certified-caption center">Finding a legendary flexâ€¦</p>
            <div class="center">
              <button class="btn" onclick="window.location.href='trophies.html'">Relive the Moment</button>
            </div>
          </div>
        </div>

        <!-- Talk -->
        <div class="box">
          <h2 class="center">ğŸ­ Union Rewind: Talk of the Week</h2>
          <div class="talk-quote">
            <blockquote id="talkQuoteText">Scanning the Loungeâ€¦</blockquote>
            <p id="talkQuoteWho">â€”</p>
          </div>
        </div>

        <!-- Alerts -->
        <div class="box">
          <h2 class="center">ğŸ“¡ Union Alerts (last 24h)</h2>
          <ul class="incoming-drop" id="alertsList"><li>Loading fresh dropsâ€¦</li></ul>
        </div>

        <!-- Culture -->
        <div class="box">
          <h2 class="center">ğŸ’ª Built by GSU. Flexed by Gamers.</h2>
          <div class="culture-grid">
            <a href="games.html" class="culture-tile">ğŸ® Game Lineup<div class="tile-hover">What Weâ€™re Really Playing.</div></a>
            <a href="boss-fight-strategies.html" class="culture-tile">âš”ï¸ Boss Fight Guides<div class="tile-hover">Dominate Every Encounter.</div></a>
            <a href="gameplay-tutorials.html" class="culture-tile">ğŸ“ Gameplay Tutorials<div class="tile-hover">Learn Fast. Play Smarter.</div></a>
            <a href="community-gameplay-videos.html" class="culture-tile">ğŸ¥ Gameplay Hub<div class="tile-hover">Your Best Runs. On Display.</div></a>
            <a href="combo-guides.html" class="culture-tile">ğŸ¥Š Combo Guides<div class="tile-hover">Damage That Matters.</div></a>
            <a href="trophy-tips.html" class="culture-tile">ğŸ“ˆ Trophy Tips<div class="tile-hover">Level Up Without Wasting Time.</div></a>
            <a href="uploads.html" class="culture-tile">ğŸ’¬ Player Lounge<div class="tile-hover">Talk Real. Squad Up.</div></a>
            <a href="art.html" class="culture-tile">ğŸ–¼ï¸ Fan Art<div class="tile-hover">Clipped. Posted. Respected.</div></a>
          </div>
        </div>

        <!-- Spotlight -->
        <div class="box" id="spotlight3">
          <h2>ğŸ® GameSync Spotlight 3</h2>
          <p>Daily gameplay drops from the titles that matter to you.</p>
          <div id="fav-game-updates"></div>
        </div>
      </main>

      <!-- RIGHT -->
      <aside>
        <div class="box match-review-style">
          <h2>ğŸ•¹ï¸ The GameSync Game Room</h2>
          <p style="color:#cfcfcf; font-size:.95rem" class="mt-05">Quick hitters that test reflexes, focus, and precision.</p>
          <div class="mt-10" style="display:flex; flex-direction:column; gap:.5rem">
            <button class="btn" style="font-size:.9rem" onclick="location.href='Charge_Run.html'">GSU Charge Run</button>
            <button class="btn" style="font-size:.9rem">GSU Command Strike</button>
            <button class="btn" style="font-size:.9rem">GSU Cipher Storm</button>
          </div>
        </div>

        <div class="box match-review-style">
          <h2>ğŸ§  Game Dev Knowledge Drop</h2>
          <p style="color:#cfcfcf; font-size:.95rem" class="mt-05">Level design is more psychology than geometry.</p>
          <div class="mt-10">
            <div style="font-size:.95rem">ğŸ“˜ Flow, affordances, and feedback loops.</div>
            <button class="btn mt-10" style="font-size:.9rem">ğŸ“š Learn More</button>
          </div>
        </div>

        <div class="box match-review-style">
          <h2>ğŸ’¬ GSU Vibe Check</h2>
          <p style="color:#cfcfcf; font-size:.95rem" class="mt-05">We scan the Lounge, uploads, and plays for the pulse.</p>
          <div class="mt-10" style="display:flex; flex-direction:column; gap:.5rem">
            <div style="font-weight:700">ğŸ”¥ Mood: Hype & Competitive</div>
            <div style="color:#bdbdbd">Top quoted: â€œDonâ€™t get perfect-parried again.â€</div>
            <div style="color:#bdbdbd">Top activity: Trophy flexes + fan art drops</div>
            <button class="btn" style="font-size:.9rem">ğŸ“¡ Scan Live Vibe</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <footer>
    <div class="platform-icons">
      <img src="PS_Logo.png" alt="PlayStation"/>
      <img src="Xbox.png" alt="Xbox"/>
      <img src="Steam.png" alt="PC"/>
      <img src="Switch.png" alt="Nintendo Switch"/>
    </div>
    <p class="center" style="color:#cfcfcf; padding-bottom:14px">&copy; 2025 GameSync Union. Built for gamers, by gamers.</p>
  </footer>

  <!-- Edit Modal -->
  <div id="editModal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:60;">
    <div class="modal-content" style="max-width:520px">
      <span class="close" onclick="closeEditModal()">&times;</span>
      <h2>Update Profile</h2>

      <label>Username:</label>
      <input type="text" id="editUsername" placeholder="Change your Username" class="input-field" style="margin:10px 0 14px">

      <label>Platform:</label>
      <select id="editPlatform" class="input-field">
        <option value="">-- Select your new Platform --</option>
        <option value="PlayStation">PlayStation</option>
        <option value="PC">PC</option>
        <option value="Xbox">Xbox</option>
        <option value="Nintendo">Nintendo</option>
        <option value="Multiple">Multiple Platforms</option>
      </select>

      <label>Favorite Games (comma-separated):</label>
      <input type="text" id="editGames" placeholder="Spider-Man 2, Ratchet & Clank..." class="input-field">

      <label>Number of Games Played:</label>
      <input type="number" id="editGamesPlayed" min="0" class="input-field">

      <label>Favorite Games' Cover Image URLs (comma-separated):</label>
      <input type="text" id="editGameImages" placeholder="url1, url2, url3" class="input-field">

      <label>Total Trophy Count:</label>
      <input type="number" id="editTrophies" min="0" class="input-field">

      <button class="btn" onclick="saveProfileChanges()">Save Changes</button>
    </div>
  </div>

  <!-- Signed-out notice + overlay -->
  <div id="authNotice" style="display:none; position:fixed; top:12%; left:50%; transform:translateX(-50%); background:#fff; color:#e60023; border:2px solid #e60023; padding:1rem 1.25rem; border-radius:12px; z-index:70; font-family:Montserrat,sans-serif; font-size:.95rem; max-width:360px; box-shadow:0 0 20px rgba(0,0,0,.3); text-align:center;">
    <div style="color:#000; font-weight:700; margin-bottom:.5rem">Signed out:</div>
    <div style="color:#111; margin-bottom:.8rem">Access limited â€” sign in or create your GSU account to get the full GSU experience.</div>
    <button class="btn" onclick="hideAuthNotice()" style="padding:.5rem .9rem">Close</button>
  </div>
  <div id="authOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:65;"></div>

  <!-- ===== JS: UI bits used by modules ===== -->
  <script>
    const RetroFacts=[
      "ğŸ•¹ï¸ Donkey Kong (1981) introduced Jumpman â€” who would later become Mario.",
      "ğŸ§± Tetris (1984) was created by a Soviet engineer and smuggled out of the USSR.",
      "ğŸ’¾ NES cartridges used 'lockout chips' to prevent unlicensed games.",
      "ğŸ¯ Pong (1972) was so popular the original machine overflowed with quarters and broke.",
      "ğŸ‘¾ Space Invaders (1978) was the first game to increase difficulty as you played.",
      "ğŸ¤ Mortal Kombat helped spark the ESRB rating system.",
      "ğŸŒ€ SNES Mode 7 enabled fake 3D in F-Zero and Mario Kart."
    ];
    const CharacterAssignments=[
      {name:"Peter Parker/Spider-Man",role:"superhero",desc:"Smarts, strength, and soul. You choose right â€” even when it costs you.",img:"https://cdn2.unrealengine.com/egs-marvelsspidermandigitaldeluxeedition-insomniacgamesnixxessoftware-editions-g1a-00-1920x1080-f8f8dc068a4d.jpg",platforms:["PlayStation","PC"]},
      {name:"Kratos",role:"anti-hero",desc:"Fueled by rage, guided by growth. You donâ€™t run â€” you conquer.",img:"https://w0.peakpx.com/wallpaper/909/900/HD-wallpaper-kratos-game-games-god-of-war-playstation-ps4-ps5-video-games-thumbnail.jpg",platforms:["PlayStation"]},
      {name:"Miles Morales",role:"superhero",desc:"Weight of two worlds, still moving with purpose. Youâ€™re the spark.",img:"https://static0.gamerantimages.com/wordpress/wp-content/uploads/2021/02/spider-man-miles-morales-web-fired-at-screen-night-time.jpg",platforms:["PlayStation","PC"]},
      {name:"Aloy",role:"hunter-protector",desc:"Curiosity + courage. You push boundaries to save the world.",img:"https://media.wired.com/photos/623233505f9392d9abe3e43e/master/pass/Horizon-Forbidden-West-Spoilers-Character-Games-Culture.jpg",platforms:["PlayStation","PC"]},
      {name:"Jin Sakai",role:"samurai-turned-ghost",desc:"Honor matters â€” survival adapts. You do what it takes.",img:"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/f03405b5-4361-4440-9bd3-6e7db6e9d0e2/dhozwq1-b24c7a15-142b-4437-8f67-de4e96005537.jpg",platforms:["PlayStation"]},
      {name:"Ratchet",role:"galactic hero",desc:"Inventive, loyal, ready to blast through any challenge.",img:"https://platform.theverge.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/22528658/RACRA_Juggernaut_Legal_scaled.jpeg?quality=90&strip=all&crop=7.8125,0,84.375,100",platforms:["PlayStation"]},
      {name:"Mario",role:"hero-plumber",desc:"Heart and hustle. Itâ€™s-a you!",img:"https://static0.gamerantimages.com/wordpress/wp-content/uploads/2023/03/super-mario-odyssey-sequel-beanbean-kingdom.jpg",platforms:["Nintendo"]},
      {name:"Donkey Kong",role:"jungle powerhouse",desc:"Bold, strong, unshakable. Loyal to your crew.",img:"https://metro.co.uk/wp-content/uploads/2025/06/SEI_255987806-22f2.jpg?quality=90&strip=all&w=646",platforms:["Nintendo"]},
    ];
    function $(id){return document.getElementById(id)}
    function loadRetroFact(){ const r=RetroFacts[Math.floor(Math.random()*RetroFacts.length)]; $("retro-fact").textContent=r; }
    function updateCharacterOptions(){
      const p=$("platform-select").value, role=$("character-role"), desc=$("character-desc"), img=$("character-image"), msg=$("no-character-msg");
      if(!p){ role.textContent=""; desc.textContent=""; img.src="GSU_LOGO.png"; msg.style.display="block"; return; }
      const pool=CharacterAssignments.filter(c=>c.platforms.includes(p));
      if(!pool.length){ role.textContent=""; desc.textContent=""; img.src="GSU_LOGO.png"; msg.style.display="block"; return; }
      const choice=pool[Math.floor(Math.random()*pool.length)];
      role.textContent=`ğŸ® You Are: ${choice.name} (${choice.role})`;
      desc.textContent=choice.desc; img.src=choice.img; msg.style.display="none";
    }
    window.showAuthNotice=function(){ $("authNotice").style.display="block"; $("authOverlay").style.display="block"; }
    window.hideAuthNotice=function(){ $("authNotice").style.display="none"; $("authOverlay").style.display="none"; }
    window.addEventListener("DOMContentLoaded",()=>{ loadRetroFact(); updateCharacterOptions(); });
  </script>

  <!-- ===== Firebase + data wiring ===== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, setPersistence, browserLocalPersistence, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, collection, query, where, orderBy, limit, getDocs, getCountFromServer, Timestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey:"AIzaSyBA7aIUj919ub7QtkQkAp-xv4XC0tzmSCI",
      authDomain:"gamesync-union.firebaseapp.com",
      projectId:"gamesync-union",
      storageBucket:"gamesync-union.appspot.com",
      messagingSenderId:"488911705365",
      appId:"1:488911705365:web:ad8b3be7936a46bb77c51c",
      measurementId:"G-CP48EXW1EV"
    };

    const app=initializeApp(firebaseConfig);
    const auth=getAuth(app);
    const db=getFirestore(app);
    window.db=db; window.auth=auth; // expose

    setPersistence(auth, browserLocalPersistence).catch(console.error);

    /* Auth UI */
    const emailInput=document.querySelector('#auth-box input[placeholder="Email"]');
    const passwordInput=document.querySelector('#auth-box input[placeholder="Password"]');
    const signInBtn=document.getElementById('signInBtn');
    const createAccountBtn=document.getElementById('createAccountBtn');

    createAccountBtn?.addEventListener('click',()=>window.location.href="account_creation.html");
    signInBtn?.addEventListener('click',async()=>{
      const email=(emailInput?.value||"").trim(); const password=(passwordInput?.value||"");
      if(!email||!password){ alert("Enter both Email and Password."); return; }
      try{ const cred=await signInWithEmailAndPassword(auth,email,password); await loadProfile(cred.user.uid); alert("Signed in successfully"); }
      catch(err){ alert("Login failed: "+err.message); }
    });

    document.getElementById("logoutBtn")?.addEventListener("click",()=>signOut(auth).catch(e=>alert(e.message)));

    /* Profile load/update */
    async function loadProfile(uid){
      const snap=await getDoc(doc(db,"users",uid));
      if(!snap.exists()) return;
      const data=snap.data();
      const favGames = Array.isArray(data.favoriteGames) ? data.favoriteGames : [];
      const favImgs  = Array.isArray(data.favoriteImages) ? data.favoriteImages : [];

      // meta
      const metaUser=document.querySelector(".username-info");
      const metaPlat=document.querySelector(".platform-info");
      metaUser.textContent=`ğŸ‘¤ Username: ${data.username||"N/A"}`;
      metaPlat.textContent=`ğŸ”¹ Platform: ${data.platform||"N/A"}`;

      // stats
      document.getElementById("fav-games").lastElementChild
      document.getElementById("fav-games").innerHTML   = `<span class="icon">ğŸ”¥</span><span>Favorite Games: ${favGames.length?favGames.join(", "):"N/A"}</span>`;
      document.getElementById("games-played").innerHTML= `<span class="icon">ğŸ®</span><span>Number Of Games Played: ${data.gamesPlayed ?? "N/A"}</span>`;
      document.getElementById("trophy-stats").innerHTML= `<span class="icon">ğŸ†</span><span>Trophy Stats (Total Trophies): ${data.trophyCount ?? "N/A"}</span>`;

      // covers
      const row=document.getElementById("fav-images");
      row.innerHTML="";
      favImgs.slice(0,3).forEach((url,i)=>{
        const img=document.createElement("img");
        img.src=url; img.alt=favGames[i]||`Game ${i+1}`; img.className="profile-fav-img update-flash-img";
        row.appendChild(img);
      });
    }

    window.openEditModal=function(){
      document.getElementById('editModal').style.display='block';
      document.getElementById('editGames').value = document.getElementById('fav-games').textContent.replace(/^.*?:\s*/,'');
      document.getElementById('editGamesPlayed').value = (document.getElementById('games-played').textContent.match(/\d+/)||[""])[0];
      document.getElementById('editTrophies').value = (document.getElementById('trophy-stats').textContent.match(/\d+/)||[""])[0];
      document.getElementById('editUsername').value = document.querySelector(".username-info")?.textContent.replace("ğŸ‘¤ Username: ","")||'';
      document.getElementById('editPlatform').value = document.querySelector(".platform-info")?.textContent.replace("ğŸ”¹ Platform: ","")||'';
    };
    window.closeEditModal=function(){ document.getElementById('editModal').style.display='none'; };

    window.saveProfileChanges=async function(){
      const user=auth.currentUser; if(!user){ alert("You must be signed in."); return; }
      const games=document.getElementById('editGames').value.trim();
      const gamesPlayed=document.getElementById('editGamesPlayed').value.trim();
      const imageUrls=document.getElementById('editGameImages').value.split(',').map(s=>s.trim()).filter(Boolean);
      const trophies=document.getElementById('editTrophies').value.trim();
      const username=document.getElementById('editUsername').value.trim();
      const platform=document.getElementById('editPlatform').value;

      await setDoc(doc(db,"users",user.uid),{
        username, platform,
        favoriteGames: games?games.split(',').map(s=>s.trim()):[],
        gamesPlayed: gamesPlayed?parseInt(gamesPlayed):0,
        favoriteImages: imageUrls,
        trophyCount: trophies?parseInt(trophies):0
      },{merge:true});

      await loadProfile(user.uid);
      window.closeEditModal();
    };

    /* Data blocks */
    const $ = (id)=>document.getElementById(id);
    const since = Timestamp.fromDate(new Date(Date.now()-24*60*60*1000));

    function youtubeEmbed(url){
      try{
        const u=new URL(url);
        if(u.hostname.includes("youtu.be")) return `https://www.youtube.com/embed/${u.pathname.slice(1)}`;
        if(u.hostname.includes("youtube.com")){ const v=u.searchParams.get("v"); if(v) return `https://www.youtube.com/embed/${v}`; }
      }catch{}
      return "";
    }

    async function usernameFrom(uid){
      try{ const s=await getDoc(doc(db,"users",uid)); const u=s.data()||{}; return (u.username || (u.email?.split("@")[0]) || "GSU_Player"); }
      catch{ return "GSU_Player"; }
    }

    async function buildUnionWatch(){
      const media=$("unionWatchMedia"), title=$("unionWatchTitle"), cap=$("unionWatchCaption");
      let hit=null;
      try{
        const qs=await getDocs(query(collection(db,"submissions"), where("timestamp",">=",since), orderBy("timestamp","desc"), limit(15)));
        hit=qs.docs.map(d=>({id:d.id,...d.data()})).find(x=>x.videoUrl);
      }catch{}
      if(!hit){
        try{
          const qs=await getDocs(query(collection(db,"submissions"), orderBy("timestamp","desc"), limit(20)));
          hit=qs.docs.map(d=>({id:d.id,...d.data()})).find(x=>x.videoUrl);
        }catch{}
      }
      if(!hit){ title.textContent="No featured clip yet â€” be the first!"; cap.textContent=""; media.innerHTML=""; return; }
      const user=await usernameFrom(hit.userId);
      const embed=youtubeEmbed(hit.videoUrl);
      media.innerHTML= embed ? `<iframe src="${embed}" allowfullscreen></iframe>` : `<img src="${hit.cover||'GSU_LOGO.png'}" alt="Clip" class="profile-fav-img" style="height:auto">`;
      title.textContent=`@${user} â€” ${hit.title||"Featured Clip"}`;
      cap.textContent=hit.caption||"Certified GSU moment.";
    }

    async function buildCertifiedMoment(){
      const img=$("certifiedImg"), p=$("certifiedCaption");
      try{
        const qs=await getDocs(query(collection(db,"community_trophies"), orderBy("timestamp","desc"), limit(1)));
        const d=qs.docs[0]?.data();
        if(!d){ p.textContent="No trophies yet â€” earn one and take the spotlight."; return; }
        const user=await usernameFrom(d.userId);
        img.src=d.cover||"GSU_LOGO.png"; img.alt=d.game||"Trophy";
        p.innerHTML=`"${d.title||d.description||'New Trophy'}" â€” <strong>@${user}</strong>`;
      }catch{ p.textContent="Couldnâ€™t load trophies."; }
    }

    async function buildTalkOfWeek(){
      const q=$("talkQuoteText"), w=$("talkQuoteWho");
      try{
        const qs=await getDocs(query(collection(db,"submissions"), orderBy("timestamp","desc"), limit(10)));
        const hit=qs.docs.map(d=>d.data()).find(x => (x.caption||"").length>0);
        if(hit){ const user=await usernameFrom(hit.userId); q.textContent=`â€œ${String(hit.caption).trim().replace(/^["â€œ]|["â€]$/g,"")}â€`; w.textContent=`â€” @${user}`; return; }
      }catch{}
      q.textContent="â€œBro didnâ€™t dodge â€” he teleported ğŸ’€â€"; w.textContent="â€” GSU Lounge";
    }

    async function safeCount(col, parts=[]){
      try{ const base=collection(db,col); const q=parts.length?query(base,...parts):base; const snap=await getCountFromServer(q); return snap.data().count||0; }
      catch{ return 0; }
    }
    async function countSubmissions({type=null,hasVideo=false}={}){
      try{
        if(type){ const n=await safeCount("submissions",[where("type","==",type)]); if(n) return n; }
        const qs=await getDocs(query(collection(db,"submissions"), orderBy("timestamp","desc"), limit(200)));
        return qs.docs.filter(d=>{ const x=d.data()||{}; const okType= type? String(x.type||"").toLowerCase()===type : true; const okMedia= hasVideo? !!x.videoUrl : true; return okType && okMedia; }).length;
      }catch{ return 0; }
    }
    async function sumPollVotes(){
      try{
        const qs=await getDocs(collection(db,"polls"));
        return qs.docs.reduce((s,d)=>{ const p=d.data()||{}; if(typeof p.totalVotes==="number") return s+p.totalVotes;
          if(Array.isArray(p.options)) return s + p.options.reduce((a,o)=>a+Number(o.votes??o.count??0),0);
          if(p.choices && typeof p.choices==="object") return s + Object.values(p.choices).reduce((a,v)=>a+Number(v||0),0);
          return s; },0);
      }catch{ return 0; }
    }
    async function populateStats(){
      const seven=Timestamp.fromDate(new Date(Date.now()-7*24*3600*1000));
      document.getElementById("totalMembers").textContent = await safeCount("users");
      document.getElementById("newMembers").textContent   = await safeCount("users",[where("createdAt",">=",seven)]);
      document.getElementById("videoUploads").textContent = await countSubmissions({hasVideo:true});
      document.getElementById("fanArt").textContent       = await safeCount("community_art");
      document.getElementById("trophies").textContent     = await safeCount("community_trophies");
      document.getElementById("combos").textContent       = await countSubmissions({type:"combo"});
      document.getElementById("pollVotes").textContent    = await sumPollVotes();
    }

    /* Spotlight (YouTube) */
    const spotlightRef=document.getElementById("fav-game-updates");
    const YT_KEY="AIzaSyBtVEG3436lk_I4gfKCAxYSRv_IBU6lcBA";

    function dayKey(){return new Date().toISOString().slice(0,10)}
    function hash(s){ let h=2166136261>>>0; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=Math.imul(h,16777619);} return h>>>0;}
    function dailyPickIndex(n,salt=""){return n?hash(dayKey()+salt)%n:0}

    async function rotateYouTubeVideosForUser(uid){
      if(!spotlightRef) return;
      if(!YT_KEY){ spotlightRef.innerHTML=`<p class="center" style="color:var(--gsu-red)">Add your YouTube API key to enable personalized gameplay drops.</p>`; return; }
      try{
        const snap=await getDoc(doc(db,"users",uid));
        if(!snap.exists()){ spotlightRef.innerHTML="<p class='center' style='color:red'>âŒ No user data found.</p>"; return; }
        const { favoriteGames=[] } = snap.data();
        if(!favoriteGames.length){ spotlightRef.innerHTML="<p class='center' style='color:red'>âŒ No favorite games set.</p>"; return; }

        spotlightRef.innerHTML="<p class='center'>ğŸ”„ Loading gameplay drops...</p>";

        const offset=dailyPickIndex(Math.max(1,favoriteGames.length),"vids");
        const show=[favoriteGames[(0+offset)%favoriteGames.length], favoriteGames[(1+offset)%favoriteGames.length], favoriteGames[(2+offset)%favoriteGames.length]].filter(Boolean);

        const blocks=await Promise.all(show.map(async(title)=>{
          const q=encodeURIComponent(title.replace(/[^\w\s:]/gi,"").trim()+" gameplay");
          try{
            const res=await fetch(`https://www.googleapis.com/youtube/v3/search?key=${YT_KEY}&part=snippet&type=video&maxResults=5&q=${q}`);
            const data=await res.json();
            if(data?.error?.errors?.[0]?.reason==="quotaExceeded"){
              return `<div class="center" style="color:var(--gsu-red); padding:10px;">YouTube quota temporarily exceeded for today.</div>`;
            }
            const v=data.items?.find(i=>i.id?.kind==="youtube#video")?.id?.videoId;
            if(!v) throw new Error("No video");
            return `<div class="spotlight-video"><iframe src="https://www.youtube.com/embed/${v}" allowfullscreen></iframe><h3 style="margin:.4rem 0 0; color:var(--gsu-red)">ğŸ® ${title}</h3><p style="color:#bbb; margin:.25rem 0 0">â–¶ï¸ Daily gameplay drop</p></div>`;
          }catch{ return `<div class="center" style="color:red">âŒ Failed to load video for <strong>${title}</strong></div>`; }
        }));
        spotlightRef.innerHTML=blocks.join("");
      }catch(e){
        console.error(e);
        spotlightRef.innerHTML=`<p class="center" style="color:red">âŒ Could not load personalized videos.</p>`;
      }
    }

    /* Auth state & page build */
    onAuthStateChanged(auth, async(user)=>{
      document.body.dataset.auth = user ? "in" : "out";
      if(user){ window.hideAuthNotice?.(); await loadProfile(user.uid); await populateStats(); rotateYouTubeVideosForUser(user.uid); }
      else{ window.showAuthNotice?.(); setTimeout(window.hideAuthNotice, 8000);
            // Clear personalized areas gracefully
            document.getElementById("fav-images").innerHTML="";
            document.getElementById("fav-game-updates").innerHTML=`<p class="center" style="color:red">âŒ Please log in to see personalized videos.</p>`;
      }
      // Always build global blocks
      buildUnionWatch(); buildCertifiedMoment(); buildTalkOfWeek(); buildAlerts();
    });

    async function buildAlerts(){
      const list=$("alertsList"); if(!list) return;
      list.innerHTML=`<li>Loadingâ€¦</li>`;
      const rows=[];
      async function pushFrom(col, maker){
        try{
          const qs=await getDocs(query(collection(db,col), where("timestamp",">=",since), orderBy("timestamp","desc")));
          for(const d of qs.docs){ const x=d.data()||{}; const user=await usernameFrom(x.userId); const line=maker(x,user); if(line) rows.push(`<li>${line}</li>`); }
        }catch{}
      }
      await pushFrom("submissions",(x,u)=> x.videoUrl ? `ğŸ¥ New upload: <strong>${x.title||'Clip'}</strong> â€” @${u}` :
        (String(x.type||"").toLowerCase()==="combo" ? `ğŸ¥Š New combo guide: <strong>${x.title||'Combo'}</strong> â€” @${u}` : null));
      await pushFrom("community_art",(x,u)=> `ğŸ¨ New art: <strong>${x.title||'Art drop'}</strong> â€” @${u}`);
      await pushFrom("community_trophies",(x,u)=> `ğŸ† New trophy: <strong>${x.title||x.game||'Trophy'}</strong> â€” @${u}`);
      list.innerHTML= rows.length ? rows.join("") : `<li>No new drops in the last 24 hours â€” be the first! ğŸ””</li>`;
    }

    // First paints for non-signed-in views
    document.addEventListener("DOMContentLoaded", ()=>{
      loadRetroFact(); updateCharacterOptions();
      buildUnionWatch(); buildCertifiedMoment(); buildTalkOfWeek(); buildAlerts();
    });
  </script>
</body>
</html>
