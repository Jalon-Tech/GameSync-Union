<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GameSync Union</title>
  <link rel="icon" href="GSU_LOGO.png" />
  <link rel="apple-touch-icon" href="GSU_LOGO.png" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
  <style>
    .update-flash-img { animation: flashGlow 1.3s ease-in-out; }

    /* One canonical flashGlow for images */
    @keyframes flashGlow {
      0%   { background-color:#e60023; color:#fff; border:2px solid #fff; box-shadow:0 0 18px 6px #e60023; margin-bottom:14px; }
      50%  { background-color:rgba(230,0,35,0.15); color:#e60023; border:2px solid #e60023; box-shadow:0 0 28px 10px #e60023; margin-bottom:24px; }
      100% { background-color:transparent; color:#fff; border:2px solid #e60023; box-shadow:none; margin-bottom:14px; }
    }

    /* Separate profile flash so it doesn't collide */
    @keyframes flashGlowProfile {
      0%   { background-color:#e60023; color:#fff; border:2px solid #fff; box-shadow:0 0 18px 6px #e60023; }
      50%  { background-color:#fff; color:#e60023; border:2px solid #e60023; box-shadow:0 0 28px 10px #fff; }
      100% { background-color:transparent; color:#fff; border:2px solid var(--gsu-red); box-shadow:none; }
    }

    .dropdown-wrapper { position:relative; display:inline-block; width:100%; }
    .dropdown-wrapper::after {
      content:"üîΩ"; position:absolute; top:50%; right:16px; transform:translateY(-50%);
      font-size:1.2rem; pointer-events:none; transition:transform .3s ease;
    }
    .dropdown-wrapper:hover::after, .dropdown-wrapper:focus-within::after { transform:translateY(-50%) rotate(180deg); }

    #editPlatform {
      width:100%; background-color:rgba(255,255,255,0.05); color:#fff; border:2px solid #e60023; border-radius:10px;
      padding:10px 40px 10px 15px; font-family:'Orbitron',sans-serif; font-size:1rem; appearance:none; cursor:pointer; position:relative; z-index:1;
    }

    .stat-box { margin-bottom:12px; padding:10px 15px; border:2px solid #e60023; border-radius:10px; background:rgba(255,255,255,0.05); transition:margin .3s ease; }

    #profile-box.update-flash p,
    #profile-box.mid-flash p,
    #profile-box.update-flash div p,
    #profile-box.mid-flash div p,
    #profile-box.update-flash > p,
    #profile-box.mid-flash > p { margin-bottom:14px!important; line-height:1.6!important; }

    #profile-box.update-flash { animation: flashGlowProfile 1.2s ease-in-out; }
    #profile-box.update-flash .stat-box, #profile-box.mid-flash .stat-box { margin-bottom:24px!important; }
    .update-flash { animation: flashGlowProfile 1.8s ease-in-out; }

    .sync-desc { font-size:.9rem; color:#ccc; font-family:'Roboto',sans-serif; margin-bottom:1rem; }

    .match-review-style h2 {
      color:#e60023; font-family:'Montserrat',sans-serif; font-size:1.2rem; margin-bottom:.75rem;
      text-shadow:0 0 8px rgba(230,0,35,.7); border-bottom:2px solid #e60023; padding-bottom:.5rem;
    }
    .match-review-style { background:#1f1f1f; border:2px solid #333; border-radius:12px; padding:1rem; box-shadow:0 0 12px rgba(255,255,255,.05); transition:transform .3s, box-shadow .3s; }
    .match-review-style:hover { transform:scale(1.01); box-shadow:0 0 14px rgba(230,0,35,.2); }

    .review-box { border:2px solid #fff; background:#1c1c1c; color:#fff; padding:.75rem; border-radius:10px; font-family:'Roboto',sans-serif; transition:border-color .3s; width:100%; resize:vertical; min-height:100px; }
    .review-box:focus { outline:none; border-color:#e60023; }

    .retro-body .game-title { font-size:1rem; font-weight:bold; color:var(--gsu-red); margin-bottom:.4rem; }
    #reviewGame, #reviewText {
      background:#222; color:#fff; border:2px solid #444; border-radius:8px; padding:8px; font-size:.9rem; margin-bottom:.6rem; transition:border .3s, box-shadow .3s;
    }
    #reviewGame:focus, #reviewText:focus { border-color:var(--gsu-red); box-shadow:0 0 8px rgba(230,0,35,.4); outline:none; }
    #reviewText { min-height:80px; resize:vertical; }

    #quick-review-box { background:#1f1f1f; border:2px solid #333; border-radius:12px; padding:1rem; box-shadow:0 0 8px rgba(0,0,0,.2); transition:all .3s; animation:fadeSlideIn .5s ease-out; }
    #quick-review-box:hover { transform:translateY(-6px) scale(1.01); box-shadow:0 6px 16px rgba(230,0,35,.4), 0 0 8px rgba(255,255,255,.05); border:1px solid var(--gsu-red); }
    #quick-review-box h2 {
      color:#e60023; font-family:'Montserrat',sans-serif; font-size:1.2rem; margin-bottom:.75rem; text-shadow:0 0 8px rgba(230,0,35,.7); border-bottom:2px solid #e60023; padding-bottom:.5rem;
    }

    @keyframes fadeSlideIn { 0%{opacity:0; transform:translateY(10px);} 100%{opacity:1; transform:translateY(0);} }

    main > .box:not(:last-child) { margin-bottom:2.2rem; }
    #profile-box { background:linear-gradient(to bottom right,#1e1e1e,#282828); border:2px solid var(--gsu-red); box-shadow:0 0 12px rgba(230,0,35,.2); border-radius:10px; text-align:center; font-size:1rem; animation:fadeSlideIn .5s ease-out; }

    .retro-flashback { background:var(--black-faded); border-radius:8px; padding:1rem; font-family:'Roboto',sans-serif; color:var(--white-text); box-shadow:0 0 8px rgba(255,0,55,.12); transition:transform .3s, box-shadow .3s; }
    .retro-flashback:hover { transform:translateY(-4px); box-shadow:0 0 14px rgba(230,0,35,.25); }
    .retro-header { font-size:1.1rem; color:var(--gsu-red); font-family:'Montserrat',sans-serif; margin-bottom:.6rem; }
    .retro-body .game-fact { font-size:.9rem; line-height:1.5; color:#ccc; }

    .livewire-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:1rem; margin-top:1rem; }
    .stat-item { background:#2a2a2a; padding:1rem; border-radius:8px; font-size:.95rem; font-family:'Roboto',sans-serif; transition:transform .3s, box-shadow .3s; box-shadow:0 0 6px rgba(0,0,0,.3); }
    .stat-item:hover { transform:scale(1.03); background:#333; box-shadow:0 0 10px rgba(230,0,35,.25); }

    .culture-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:1rem; text-align:center; }
    .culture-tile { background:#2a2a2a; padding:1.4rem 1rem; border-radius:10px; font-family:'Montserrat',sans-serif; font-size:1rem; color:#fff; text-decoration:none; position:relative; overflow:hidden; transition:transform .3s, background .3s; }
    .culture-tile:hover { background:var(--gsu-red); transform:scale(1.05); }
    .tile-hover { margin-top:.4rem; font-size:.85rem; color:#ddd; }
    .showoff-card { display:flex; gap:1rem; flex-wrap:wrap; align-items:center; background:#2a2a2a; border-radius:10px; padding:1rem; }
    .showoff-img { width:200px; height:120px; object-fit:cover; border-radius:8px; box-shadow:0 0 10px rgba(255,255,255,.1); }
    .showoff-info h3 { color:var(--gsu-red); font-family:'Montserrat',sans-serif; font-size:1.2rem; margin-bottom:.4rem; }
    .showoff-info p { font-size:.95rem; font-family:'Roboto',sans-serif; margin-bottom:.6rem; }
    .talk-quote { background:#2a2a2a; padding:1rem 1.2rem; border:4px solid var(--gsu-red); border-radius:8px; font-style:italic; }
    .talk-quote blockquote { font-size:1.1rem; color:#eee; margin-bottom:.5rem; font-family:'Montserrat',sans-serif; }
    .talk-quote p { font-size:.95rem; color:#aaa; font-family:'Roboto',sans-serif; }
    .certified-moment { text-align:center; font-family:'Roboto',sans-serif; }
    .certified-img { width:100%; max-width:400px; height:auto; border-radius:10px; box-shadow:0 0 10px rgba(255,255,255,.1); margin-bottom:.8rem; }
    .certified-caption { font-size:1rem; margin-bottom:.6rem; }
    .incoming-drop { margin-top:1rem; padding-left:1rem; color:#ddd; font-family:'Roboto',sans-serif; font-size:.95rem; list-style-type:square; }

    :root { --gsu-red:#e60023; --black-main:#191818; --black-faded:#1F1F1F; --white-text:#FFFFFF; }
    *{margin:0; padding:0; box-sizing:border-box;}
    body{ font-family:'Roboto',sans-serif; background:var(--black-main); color:var(--white-text); }

    header { background:var(--black-faded); display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; flex-wrap:wrap; gap:1rem; position:relative; z-index:1000; }
    .logo{ display:flex; align-items:center; }
    .logo img{ height:60px; margin-right:1rem; }
    .logo-text{ font-size:1.6rem; font-family:'Montserrat',sans-serif; color:var(--white-text); }
    nav{ display:flex; flex-wrap:wrap; gap:1rem; }
    nav a{ text-decoration:none; color:var(--white-text); font-family:'Montserrat',sans-serif; transition:color .3s; font-size:1rem; }
    nav a:hover{ color:var(--gsu-red); }

    .main-container{ display:grid; grid-template-columns:1fr 3fr 1fr; gap:1.5rem; padding:2rem; }
    aside, main{ display:flex; flex-direction:column; gap:1.2rem; }
    .box{ background:var(--black-faded); border-radius:12px; padding:1rem; color:var(--white-text); transition:transform .3s, box-shadow .3s, border .3s; border:2px solid #333; box-shadow:0 0 12px rgba(255,255,255,.05); }
    .box:hover{ transform:translateY(-6px) scale(1.01); box-shadow:0 6px 16px rgba(230,0,35,.4), 0 0 10px rgba(255,255,255,.05); border:2px solid var(--gsu-red); }
    .box li{ transition:transform .3s; } .box:hover li{ transform:translateX(6px); }
    .box h2{ font-family:'Montserrat',sans-serif; margin-bottom:.7rem; color:#fff!important; text-shadow:0 0 6px rgba(255,0,55,.3); }

    .input-field{ padding:.6rem; border:none; border-radius:6px; margin-bottom:.6rem; width:100%; background:#2a2a2a; color:var(--white-text); }
    .btn{ background:var(--gsu-red); border:none; color:#fff; padding:.8rem; width:100%; border-radius:6px; cursor:pointer; font-family:'Montserrat',sans-serif; }
    .btn:hover{ opacity:.85; }

    footer{ background:var(--black-faded); text-align:center; padding:1.2rem 1rem; margin-top:4rem; }
    .platform-icons{ display:flex; justify-content:center; align-items:center; gap:1.5rem; margin-bottom:.6rem; }
    .platform-icons img{ height:32px; width:auto; opacity:.9; }
    footer p{ color:#ccc; font-size:1rem; font-family:'Roboto',sans-serif; }

    .section-flex{ display:flex; justify-content:space-between; gap:1rem; flex-wrap:wrap; }
    .section-flex div{ flex:1 1 100px; text-align:center; }

    @media (max-width:1024px){
      .main-container{ grid-template-columns:1fr; padding:1rem; }
      header{ flex-direction:column; align-items:flex-start; }
      nav{ justify-content:flex-start; }
      .logo-text{ font-size:1.3rem; }
      .section-flex{ flex-direction:column; text-align:center; }
    }
    @media (max-width:600px){
      .logo img{ height:40px; }
      .logo-text{ font-size:1.2rem; }
      nav a{ font-size:.9rem; }
      .btn{ padding:.7rem; }
      .input-field{ font-size:.9rem; }
    }

    #spotlight3{
      background:linear-gradient(to bottom right,#1f1f1f,#262626); border:2px solid transparent; border-radius:12px; padding:2rem 1.5rem;
      box-shadow:0 0 16px rgba(230,0,35,.3); color:var(--white-text); font-family:'Montserrat',sans-serif; text-align:center; margin-bottom:1.5rem; transition:border .3s; max-width:800px; margin-left:auto; margin-right:auto;
    }
    #spotlight3:hover{ border-color:var(--gsu-red); }
    #spotlight3 h2{ color:var(--gsu-red); font-size:1.4rem; margin-bottom:.5rem; }
    #spotlight3 p{ font-size:.95rem; color:#ccc; margin-bottom:1.2rem; }
    .spotlight-video:hover{ transform:scale(1.02); border-color:var(--gsu-red); box-shadow:0 0 12px rgba(255,255,255,.1); }
    .spotlight-video iframe{ width:100%; height:340px; border-radius:10px; }
    @media (max-width:768px){ .spotlight-video iframe{ height:220px; } }
    .spotlight-video iframe{ margin-top:.5rem; margin-bottom:.5rem; }
    .spotlight-video h3{ color:var(--gsu-red); margin-bottom:.5rem; font-size:1.1rem; font-family:'Montserrat',sans-serif; }

    /* Character image: only keep the sync-box sizing */
    #character-image{
      height:140px; width:140px; object-fit:contain; border-radius:10px; padding:6px; background-color:#000; border:1px solid #444; transition:transform .3s ease; display:block; margin:0 auto;
    }
    #character-image:hover{ transform:scale(1.05); box-shadow:0 0 12px rgba(255,255,255,.2); }
    #character-desc{ font-size:.85rem; max-width:260px; color:#ccc; text-align:left; }

    #fav-images{ scroll-behavior:smooth; display:flex; overflow-x:auto; scroll-snap-type:x mandatory; gap:1rem; padding:.5rem 0; justify-content:flex-start; max-width:100%; }
    #fav-images::-webkit-scrollbar{ height:8px; }
    #fav-images::-webkit-scrollbar-thumb{ background-color:var(--gsu-red); border-radius:6px; }
    #fav-images img{
      height:280px; width:auto; object-fit:contain; scroll-snap-align:center; background:#111; padding:6px; border-radius:12px; box-shadow:0 0 10px rgba(255,255,255,.08); transition:transform .3s, box-shadow .3s;
    }
    #fav-images img:hover{ transform:scale(1.05); box-shadow:0 0 12px rgba(230,0,35,.3); }

    .profile-fav-img{ height:280px; object-fit:contain; background:#111; border-radius:12px; box-shadow:0 0 10px rgba(255,255,255,.08); transition:transform .3s; scroll-snap-align:center; padding:6px; }
    .profile-fav-img:hover{ transform:scale(1.05); box-shadow:0 0 12px rgba(230,0,35,.3); }

    #upcoming-events{ animation:fadeSlideIn .6s ease-out; }

    #character-sync-box{
      border:2px solid #e60023; border-radius:12px; padding:12px; margin-top:1rem; background:#1a1a1a; transition:transform .3s, box-shadow .3s; box-shadow:0 0 10px rgba(230,0,35,.4);
    }
    #character-sync-box:hover{ transform:scale(1.02); box-shadow:0 0 18px rgba(230,0,35,.6); }

    .gsu-sync-box{
      background:#1f1f1f; border:2px solid #333; border-radius:12px; padding:1.2rem; margin-bottom:1.5rem; transition:transform .3s, box-shadow .3s, border .3s; box-shadow:0 0 10px rgba(255,255,255,.05);
    }
    .gsu-sync-box:hover{ transform:translateY(-6px); box-shadow:0 6px 16px rgba(230,0,35,.4), 0 0 10px rgba(255,255,255,.05); border:2px solid var(--gsu-red); }

    .gsu-dropdown{
      width:100%; padding:12px; margin:10px 0 18px; background:rgba(255,255,255,.05); color:#fff; border:2px solid #e60023; border-radius:10px; font-family:'Orbitron',sans-serif; font-size:1rem; transition:box-shadow .3s, background-color .3s;
      appearance:none; background-position:right 18px center; background-size:16px; padding-right:48px; height:42px; line-height:1.2;
    }
    .gsu-dropdown:hover, .gsu-dropdown:focus{ box-shadow:0 0 10px 2px #e60023; outline:none; background-color:rgba(255,255,255,.08); }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="GSU_LOGO.png" alt="GSU Logo" />
      <div class="logo-text">GAMESYNC UNION</div>
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="games.html">Games</a>
      <a href="trophies.html">GSU Hall of Trophies & Achievements</a>
      <a href="art.html">Art</a>
      <a href="game-guides.html">GSU Gameplay Center</a>
      <a href="uploads.html">GSU Player Lounge</a>
    </nav>
    <button id="logoutBtn" class="btn" style="max-width:120px; background-color:#777;">Log Out</button>
  </header>

  <div class="main-container">
    <aside>
      <div class="box" id="auth-box">
        <h2>Create Account or Sign In</h2>
        <input type="text" class="input-field" placeholder="Email" />
        <input type="text" class="input-field" placeholder="Username" />
        <input type="password" class="input-field" placeholder="Password" />
        <button class="btn">Sign In</button>
        <p style="text-align:center; margin-top:.6rem;">
          Not a GSU member?
          <button class="btn" id="createAccountBtn" style="display:block; margin:1rem auto; padding:.25rem .75rem; font-size:.85rem;">
            Create your GSU account
          </button>
        </p>
      </div>

      <div class="box match-review-style">
        <h2 class="retro-header">üïπÔ∏è Retro Game Flashback</h2>
        <p style="font-size:.9rem; color:#ccc; font-family:'Roboto',sans-serif; margin-bottom:.8rem;">
          Step back into the early days of gaming, when every level was a challenge and every victory felt earned. This flashback spotlights a title that helped shape the industry ‚Äî a reminder of where the journey began.
        </p>
        <div class="retro-body">
          <div class="game-title">From here, the Retroverse info unfolds.</div>
          <div class="game-fact" id="retro-fact" style="max-height:90px; overflow-y:auto;">Loading fact...</div>
          <button class="btn" onclick="loadRetroFact()" style="margin-top:.8rem; font-size:.85rem;">üïπÔ∏è Spin the Retro Wheel</button>
        </div>
      </div>

      <div class="gsu-sync-box">
        <h2 class="retro-header">üéÆ GSU Character Sync-Up</h2>
        <p class="sync-desc">Ready to find out who you‚Äôre synced with? Choose your platform and let GSU reveal the video game character that fits your world best.</p>

        <label for="platform-select" class="sync-label">üïπÔ∏è Choose Your Platform to Begin the Sync:</label>
        <select id="platform-select" class="input-field" onchange="updateCharacterOptions()">
          <option value="">-- Choose Platform --</option>
          <option value="PlayStation">PlayStation</option>
          <option value="PC">PC</option>
          <option value="Xbox">Xbox</option>
          <option value="Nintendo">Nintendo</option>
        </select>

        <div id="no-character-msg" style="color:red; font-size:.9rem; margin-bottom:1rem; text-align:center;">No Video Game Character in Sync.</div>

        <div id="character-role" class="sync-role"></div>

        <div id="character-sync-box">
          <div style="display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center;">
            <img id="character-image" src="GSU_LOGO.png" alt="Character" />
            <div id="character-desc">Choose your platform to reveal which video game legend is synced with your GSU energy.</div>
          </div>
        </div>
      </div>

      <!-- Retro facts + character assignments -->
      <script>
        const RetroFacts = [
          "üïπÔ∏è Donkey Kong (1981) introduced Jumpman ‚Äî who would later become Mario.",
          "üß± Tetris (1984) was created by a Soviet engineer and smuggled out of the USSR.",
          "üíæ NES cartridges used 'lockout chips' to prevent unlicensed games.",
          "üéØ Pong (1972) was so popular that the original machine overflowed with quarters and broke.",
          "üéÆ The Sega Genesis had a hidden sound test screen used for cheat codes in Sonic games.",
          "üëæ Space Invaders (1978) was the first game to increase difficulty as you played.",
          "üé§ Mortal Kombat sparked U.S. government hearings that led to the ESRB rating system.",
          "üåÄ SNES Mode 7 graphics enabled fake 3D effects in F-Zero and Mario Kart.",
          "üìº Game saves didn‚Äôt exist early on ‚Äî players had to beat the game in one sitting."
        ];

        const CharacterAssignments = [
          { name:"Peter Parker/Spider-Man", role:"superhero", desc:"You balance smarts, strength, and soul. In every crisis, you choose the right thing ‚Äî even when it costs you everything.", game:"Marvel's Spider-Man 2", img:"https://cdn2.unrealengine.com/egs-marvelsspidermandigitaldeluxeedition-insomniacgamesnixxessoftware-editions-g1a-00-1920x1080-f8f8dc068a4d.jpg", platforms:["PlayStation","PC"] },
          { name:"Kratos", role:"anti-hero", desc:"Fueled by rage but guided by growth, you‚Äôve fought your past and forged a new path. You don‚Äôt run ‚Äî you conquer.", game:"God of War Ragnar√∂k", img:"https://w0.peakpx.com/wallpaper/909/900/HD-wallpaper-kratos-game-games-god-of-war-playstation-ps4-ps5-video-games-thumbnail.jpg", platforms:["PlayStation"] },
          { name:"Miles Morales", role:"superhero", desc:"You carry the weight of two worlds on your shoulders ‚Äî and still move with purpose, heart, and style. You‚Äôre the spark.", game:"Marvel's Spider-Man: Miles Morales", img:"https://static0.gamerantimages.com/wordpress/wp-content/uploads/2021/02/spider-man-miles-morales-web-fired-at-screen-night-time.jpg", platforms:["PlayStation","PC"] },
          { name:"Aloy", role:"hunter-protector", desc:"Driven by curiosity and courage, you never stop pushing boundaries. You‚Äôre not afraid to question the world to save it.", game:"Horizon Forbidden West", img:"https://media.wired.com/photos/623233505f9392d9abe3e43e/master/pass/Horizon-Forbidden-West-Spoilers-Character-Games-Culture.jpg", platforms:["PlayStation","PC"] },
          { name:"Jin Sakai", role:"samurai-turned-ghost", desc:"Honor matters ‚Äî but survival means adapting. You protect your people not by tradition, but by any means necessary.", game:"Ghost of Tsushima", img:"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/f03405b5-4361-4440-9bd3-6e7db6e9d0e2/dhozwq1-b24c7a15-142b-4437-8f67-de4e96005537.jpg", platforms:["PlayStation"] },
          { name:"Ratchet", role:"galactic hero", desc:"You‚Äôre inventive, loyal, and always ready to blast through any challenge. No matter the dimension, you rise up with grit and gear.", game:"Ratchet & Clank: Rift Apart", img:"https://platform.theverge.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/22528658/RACRA_Juggernaut_Legal_scaled.jpeg?quality=90&strip=all&crop=7.8125,0,84.375,100", platforms:["PlayStation"] },
          { name:"Mario", role:"hero-plumber", desc:"Whether it‚Äôs Bowser, bricks, or bananas, you‚Äôre jumping in with heart and hustle. It‚Äôs-a you!", game:"Super Mario Odyssey", img:"https://static0.gamerantimages.com/wordpress/wp-content/uploads/2023/03/super-mario-odyssey-sequel-beanbean-kingdom.jpg", platforms:["Nintendo"] },
          { name:"Donkey Kong", role:"jungle powerhouse", desc:"You‚Äôre bold, strong, and unshakable. Whether it‚Äôs Kremlings or chaos, you smash through with fearless energy and loyalty to your crew.", game:"Donkey Kong Bananza", img:"https://metro.co.uk/wp-content/uploads/2025/06/SEI_255987806-22f2.jpg?quality=90&strip=all&w=646", platforms:["Nintendo"] }
        ];

        function loadRetroFact() {
          const random = RetroFacts[Math.floor(Math.random() * RetroFacts.length)];
          document.getElementById("retro-fact").innerText = random;
        }

        function updateCharacterOptions() {
          const platform = document.getElementById("platform-select").value;
          const roleEl = document.getElementById("character-role");
          const descEl = document.getElementById("character-desc");
          const imgEl  = document.getElementById("character-image");
          const msgEl  = document.getElementById("no-character-msg");
          const gsuLogo = "GSU_LOGO.png";

          if (!platform) {
            roleEl.innerText = ""; descEl.innerText = ""; imgEl.src = gsuLogo; msgEl.style.display = "block"; return;
          }
          const filtered = CharacterAssignments.filter(c => c.platforms.includes(platform));
          if (!filtered.length) {
            roleEl.innerText = ""; descEl.innerText = ""; imgEl.src = gsuLogo; msgEl.style.display = "block"; return;
          }
          const chosen = filtered[Math.floor(Math.random() * filtered.length)];
          roleEl.innerText = `üéÆ You Are: ${chosen.name} (${chosen.role})`;
          descEl.innerText = chosen.desc;
          imgEl.src = chosen.img;
          msgEl.style.display = "none";
        }

        window.addEventListener('DOMContentLoaded', () => {
          loadRetroFact();
          updateCharacterOptions(); // default state
        });
      </script>
    </aside>

    <main>
      <div class="box" style="text-align:center;">
        <h2>Welcome to GameSync Union</h2>
        <p style="margin-bottom:1rem;">No pause. No kink. Just raw sync ‚Äî GameSync Union is where gamers link.</p>
        <button class="btn" onclick="window.location.href='about.html'"><h3>üìòüéÆ The Full Breakdown: GameSync Union Explained</h3></button>
      </div>

      <div class="box" id="profile-box">
        <h2 style="color:var(--gsu-red);">Your Profile</h2>
        <p id="fav-games" class="stat-box">üî• Favorite Games</p>
        <p id="games-played" class="stat-box">üéÆ Number Of Games Played</p>
        <p id="trophy-stats" class="stat-box">üèÜ Trophy Stats (Total Trophies)</p>

        <div style="margin-top:1rem;">
          <label style="color:#ccc; font-size:.9rem;">üéÆ Synced Game Covers ‚Äì Pulled from Your Top 3 Favorites</label>
        </div>

        <div id="fav-images" style="margin-top:.8rem; display:flex; overflow-x:auto; justify-content:center; flex-wrap:wrap; gap:1rem; padding:1rem 0; scroll-snap-type:x mandatory; border:1px solid #444; border-radius:10px; background:#1b1b1b;"></div>

        <div style="margin-top:1rem; text-align:center;">
          <button onclick="openEditModal()" class="edit-btn">Update GSU Profile</button>
        </div>
      </div>

      <input type="text" class="input-field" placeholder="Search guides, uploads, art, users, or trophies..." />

      <div class="box">
        <h2 style="color:var(--gsu-red); font-family:'Montserrat',sans-serif; text-align:center;">üî• Statline Supreme: All Union. All Syncd.</h2>
        <div class="livewire-stats">
          <div class="stat-item">üë• Total GSU Members: <span id="totalMembers">_</span></div>
          <div class="stat-item">üÜï New Members This Week: <span id="newMembers">_</span></div>
          <div class="stat-item">üìπ Videos Shared Across the GSU Community: <span id="videoUploads">_</span></div>
          <div class="stat-item">üé® Fan Art Pieces Shared: <span id="fanArt">_</span></div>
          <div class="stat-item">üèÜ Trophies Earned by GSU Players: <span id="trophies">_</span></div>
          <div class="stat-item">ü•ä Combo Guides Shared: <span id="combos">_</span></div>
          <div class="stat-item">üìä Total Community Poll Votes: <span id="pollVotes">_</span></div>
        </div>
      </div>

      <div class="box">
        <h2 style="color:var(--gsu-red); font-family:'Montserrat',sans-serif; text-align:center;">üí™ Built by GSU. Flexed by Gamers.</h2>
        <div class="culture-grid">
          <a href="games.html" class="culture-tile">üéÆ Game Lineup<div class="tile-hover">What We‚Äôre Really Playing.</div></a>
          <a href="boss-fight-strategies.html" class="culture-tile">‚öîÔ∏è Boss Fight Guides<div class="tile-hover">Dominate Every Encounter.</div></a>
          <a href="gameplay-tutorials.html" class="culture-tile">üéì Gameplay Tutorials<div class="tile-hover">Learn Fast. Play Smarter.</div></a>
          <a href="community-gameplay-videos.html" class="culture-tile">üé• Gameplay Hub<div class="tile-hover">Your Best Runs. On Display.</div></a>
          <a href="combo-guides.html" class="culture-tile">ü•ä Combo Guides<div class="tile-hover">Damage That Matters.</div></a>
          <a href="trophy-tips.html" class="culture-tile">üìà Trophy Tips<div class="tile-hover">Level Up Without Wasting Time.</div></a>
          <a href="uploads.html" class="culture-tile">üí¨ Player Lounge<div class="tile-hover">Talk Real. Squad Up.</div></a>
          <a href="art.html" class="culture-tile">üñºÔ∏è Fan Art<div class="tile-hover">Clipped. Posted. Respected.</div></a>
        </div>
      </div>

      <div class="box">
        <h2 style="color:var(--gsu-red); font-family:'Montserrat',sans-serif; text-align:center;">üî• Made the Union Watch</h2>
        <p style="text-align:center; font-family:'Roboto'; color: var(--white-text);">
          When the Union highlights you ‚Äî it means something. If your name‚Äôs echoing in live chat, it‚Äôs because your skills made the noise. Real gameplay earns the light.
        </p>
        <div class="showoff-card" style="flex-direction:column; align-items:center;">
          <div style="display:flex; justify-content:center;">
            <img src="https://your-image-url.jpg" alt="Elite Clip Thumbnail" class="showoff-img" />
          </div>
          <div class="showoff-info" style="text-align:center;">
            <h3>@QuantumX - ‚ÄúOne Parry, One Kill‚Äù</h3>
            <p>Disrespected the Valkyrie Queen with no HUD in God of War: Ragnar√∂k. Certified GSU moment.</p>
          </div>
        </div>
        <div style="width:100%; display:flex; justify-content:center; margin-top:1.2rem;">
          <button onclick="window.location.href='uploads.html'" class="btn" style="width:100%; max-width:240px;">See Why Everyone‚Äôs Talking</button>
        </div>
      </div>

      <div class="box">
        <h2 style="color:var(--gsu-red); font-family:'Montserrat',sans-serif; text-align:center;">üé≠ Union Rewind: Talk of the Week</h2>
        <div class="talk-quote">
          <blockquote>‚ÄúBro didn‚Äôt dodge ‚Äî he teleported üíÄ‚Äù</blockquote>
          <p>‚Äî Pulled from GSU Lounge</p>
        </div>
      </div>

      <div class="box">
        <h2 style="color:var(--gsu-red); font-family:'Montserrat',sans-serif; text-align:center;">üëë One Trophy. One Flex. You Dropped It ‚Äî Now the Union Sees Why.</h2>
        <div class="certified-moment">
          <img src="https://your-image-url.jpg" alt="Moment Screenshot" class="certified-img" />
          <p class="certified-caption">‚ÄúLeft the boss at 1% just to taunt üíÄ‚Äù ‚Äî <strong>@ThroneSnatcher</strong></p>
          <div style="text-align:center;">
            <button class="btn" onclick="window.location.href='trophies.html'" style="margin:0 auto; display:inline-block;">Relive the Moment</button>
          </div>
        </div>
      </div>

      <div class="box">
        <h2 style="color:var(--gsu-red); font-family:'Montserrat',sans-serif; text-align:center;">üì° Union Alert: Drop Goes Live Soon</h2>
        <ul class="incoming-drop">
          <li>üéØ Challenge Theme dropping Friday: <strong>‚ú® Style Over Damage</strong></li>
          <li>üñºÔ∏è Fan Art Tournament Round 2 this weekend</li>
          <li>üÜï GSU Custom Avatars launching soon</li>
        </ul>
      </div>

      <div class="box" id="spotlight3">
        <h2>üéÆ GameSync Spotlight 3</h2>
        <p>GameSync Spotlight 3 delivers gameplay from the titles that matter to you ‚Äî daily.</p>
        <div id="fav-game-updates"></div>
      </div>
    </main>

    <aside>
      <div class="box match-review-style">
        <h2 class="retro-header">üïπÔ∏è The GameSync Game Room</h2>
        <p style="font-size:.9rem; color:#ccc; font-family:'Roboto',sans-serif; margin-bottom:.8rem;">
          Explore GSU‚Äôs original mini-games‚Äîdesigned to deliver quick, high-impact experiences that challenge reflexes, focus, and precision.
        </p>
        <div class="retro-body" style="display:flex; flex-direction:column; gap:.5rem;">
          <button class="btn" style="font-size:.85rem;" onclick="location.href='Charge_Run.html'">GSU Charge Run</button>
          <button class="btn" style="font-size:.85rem;">GSU Command Strike</button>
          <button class="btn" style="font-size:.85rem;">GSU Cipher Storm</button>
        </div>
      </div>

      <div class="box match-review-style">
        <h2 class="retro-header">üß† Game Dev Knowledge Drop</h2>
        <p style="font-size:.9rem; color:#ccc; font-family:'Roboto',sans-serif; margin-bottom:.8rem;">
          Game development goes way beyond just code. Level design, engines, AI, and even psychology play a role. Level up your dev brain here.
        </p>
        <div class="retro-body" style="display:flex; flex-direction:column; gap:.5rem;">
          <div style="font-size:.85rem;">üìò <strong>Today's Topic:</strong> Why level design is more psychology than geometry.</div>
          <button class="btn" style="font-size:.85rem;">üìö Learn More</button>
        </div>
      </div>

      <div class="box match-review-style">
        <h2 class="retro-header">üí¨ GSU Vibe Check</h2>
        <p style="font-size:.9rem; color:#ccc; font-family:'Roboto',sans-serif; margin-bottom:.8rem;">
          What‚Äôs the vibe across GameSync Union right now? We scanned the Lounge, uploads, and current plays to bring you the mood.
        </p>
        <div class="retro-body" style="display:flex; flex-direction:column; gap:.6rem;">
          <div style="font-size:1rem; color:#fff; font-weight:bold;">üî• Mood: Hype & Competitive</div>
          <div style="font-size:.85rem; color:#bbb;">Top quoted: ‚ÄúDon‚Äôt get perfect-parried again.‚Äù</div>
          <div style="font-size:.85rem; color:#bbb;">Top activity: Trophy flexes + fan art drops</div>
          <button class="btn" style="margin-top:.6rem; font-size:.85rem;">üì° Scan Live Vibe</button>
        </div>
      </div>
    </aside>
  </div>

  <footer>
    <div class="platform-icons">
      <img src="PS_Logo.png" alt="PlayStation" />
      <img src="Xbox.png" alt="Xbox" />
      <img src="Steam.png" alt="PC" />
      <img src="Switch.png" alt="Nintendo Switch" />
    </div>
    <p>&copy; 2025 GameSync Union. Built for gamers, by gamers.</p>
  </footer>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeEditModal()">&times;</span>
      <h2>Update Profile</h2>

      <label>Username:</label>
      <input type="text" id="editUsername" placeholder="Change your Username">

      <label>Platform:</label>
      <div class="dropdown-wrapper">
        <select id="editPlatform">
          <option value="">-- Select your new Platform --</option>
          <option value="PlayStation">PlayStation</option>
          <option value="PC">PC</option>
          <option value="Xbox">Xbox</option>
          <option value="Nintendo">Nintendo</option>
          <option value="Multiple">Multiple Platforms</option>
        </select>
      </div>

      <label>Favorite Games (comma-separated):</label>
      <input type="text" id="editGames" placeholder="Spider-Man 2, Ratchet & Clank...">

      <label>Number of Games Played:</label>
      <input type="number" id="editGamesPlayed" min="0">

      <label>Favorite Games' Cover Image URLs (comma-separated):</label>
      <input type="text" id="editGameImages" placeholder="url1, url2, url3">

      <label>Total Trophy Count:</label>
      <input type="number" id="editTrophies" min="0">

      <button onclick="saveProfileChanges()">Save Changes</button>
    </div>
  </div>

  <style>
    .edit-btn{ background:var(--gsu-red); color:#fff; padding:10px 14px; border:none; border-radius:8px; cursor:pointer; margin-top:15px; font-family:'Montserrat',sans-serif; font-weight:600; transition:background-color .3s, transform .2s; }
    .edit-btn:hover{ background:#cc001f; transform:scale(1.03); }
    .modal{ display:none; position:fixed; z-index:100; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,.7); }
    .modal-content{ background:var(--black-faded); margin:10% auto; padding:24px; border:2px solid var(--gsu-red); border-radius:12px; width:80%; max-width:500px; color:var(--white-text); font-family:'Montserrat',sans-serif; box-shadow:0 0 12px rgba(230,0,35,.3); }
    .modal-content label{ font-weight:600; margin-top:10px; display:block; color:var(--gsu-red); }
    .modal-content input{ width:100%; padding:12px; margin:10px 0 18px; background:#2a2a2a; color:var(--white-text); border:1px solid #444; border-radius:6px; font-family:'Roboto',sans-serif; }
    .modal-content button{ background:#e60023; color:#fff; border:none; padding:12px 18px; border-radius:8px; cursor:pointer; font-weight:600; font-family:'Montserrat',sans-serif; transition:background-color .3s, transform .2s; }
    .modal-content button:hover{ background:#cc001f; transform:scale(1.03); }
    .close{ float:right; font-size:28px; font-weight:bold; color:var(--gsu-red); cursor:pointer; transition:color .3s ease; }
    .close:hover{ color:#ff3344; }

    #fav-game-updates{ display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:2rem; padding:1rem; margin-top:1rem; }
    #fav-game-updates::-webkit-scrollbar{ width:6px; }
    #fav-game-updates::-webkit-scrollbar-thumb{ background:var(--gsu-red); border-radius:6px; }
    .spotlight-video{ background:#2a2a2a; padding:1rem; border-radius:10px; border:2px solid transparent; transition:transform .3s, box-shadow .3s, border .3s; opacity:0; animation:fadeIn .5s ease forwards; width:100%; max-width:100%; }
    .spotlight-video:hover{ transform:scale(1.02); border-color:var(--gsu-red); box-shadow:0 0 10px rgba(255,255,255,.08); }
    .spotlight-video iframe{ width:100%; height:200px; border:none; border-radius:8px; margin:.6rem 0; }
    .spotlight-video h3{ font-family:'Montserrat',sans-serif; color:var(--gsu-red); font-size:1rem; padding:.8rem 1rem 0 1rem; }
    .spotlight-video p{ color:#bbb; font-size:.9rem; padding:0 1rem 1rem 1rem; }
    @keyframes fadeIn { to{opacity:1;} }
  </style>

  <!-- App + Firebase (auth/profile) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBA7aIUj919ub7QtkQkAp-xv4XC0tzmSCI",
      authDomain: "gamesync-union.firebaseapp.com",
      projectId: "gamesync-union",
      storageBucket: "gamesync-union.appspot.com",
      messagingSenderId: "488911705365",
      appId: "1:488911705365:web:ad8b3be7936a46bb77c51c",
      measurementId: "G-CP48EXW1EV"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // Persist login
    setPersistence(auth, browserLocalPersistence).catch(console.error);

    // Auth UI
    const emailInput = document.querySelector('#auth-box input[placeholder="Email"]');
    const passwordInput = document.querySelector('#auth-box input[placeholder="Password"]');
    const signInBtn = document.querySelector('#auth-box .btn');
    const createAccountBtn = document.getElementById('createAccountBtn');

    if (createAccountBtn) {
      createAccountBtn.addEventListener('click', () => window.location.href = "account_creation.html");
    }
    if (signInBtn) {
      signInBtn.addEventListener('click', async () => {
        const email = (emailInput?.value || "").trim();
        const password = passwordInput?.value || "";
        if (!email || !password) { alert("Enter both Email and Password to sign into your GSU account."); return; }
        try {
          const userCred = await signInWithEmailAndPassword(auth, email, password);
          loadProfile(userCred.user.uid);
          alert("Signed in successfully");
        } catch (err) {
          alert("Login failed: " + err.message);
        }
      });
    }

    async function loadProfile(uid) {
      window.favoriteCoverMap = {};
      const snap = await getDoc(doc(db, "users", uid));
      if (!snap.exists()) { console.warn("User profile data not found."); return; }

      const data = snap.data();
      const profileBox = document.getElementById("profile-box");

      // Username + Platform (rebuild fresh)
      profileBox.querySelector(".username-info")?.remove();
      profileBox.querySelector(".platform-info")?.remove();

      const usernameEl = document.createElement("p");
      usernameEl.className = "username-info";
      usernameEl.textContent = `üë§ Username: ${data.username || "N/A"}`;
      usernameEl.style.fontWeight = "bold";
      usernameEl.style.fontSize = "1rem";
      usernameEl.style.marginBottom = "0.5rem";
      profileBox.prepend(usernameEl);

      const platformEl = document.createElement("p");
      platformEl.className = "platform-info";
      platformEl.textContent = `üîπ Platform: ${data.platform || "N/A"}`;
      platformEl.style.fontSize = "0.95rem";
      platformEl.style.marginBottom = "0.5rem";
      profileBox.insertBefore(platformEl, usernameEl.nextSibling);

      // Stats
      const favGamesEl = document.getElementById("fav-games");
      const gamesPlayedEl = document.getElementById("games-played");
      const trophyStatsEl = document.getElementById("trophy-stats");
      const imageRow = document.getElementById("fav-images");

      favGamesEl.textContent = `üî• Favorite Games: ${Array.isArray(data.favoriteGames) ? data.favoriteGames.join(", ") : "N/A"}`;
      gamesPlayedEl.textContent = `üéÆ Number Of Games Played: ${data.gamesPlayed ?? "N/A"}`;
      trophyStatsEl.textContent = `üèÜ Trophy Stats (Total Trophies): ${data.trophyCount ?? "N/A"}`;

      imageRow.innerHTML = "";
      if (Array.isArray(data.favoriteImages)) {
        data.favoriteImages.forEach((url, index) => {
          const img = document.createElement("img");
          img.src = url;
          img.alt = (data.favoriteGames && data.favoriteGames[index]) || `Game ${index+1}`;
          img.classList.add("profile-fav-img");
          imageRow.appendChild(img);
        });
      }
    }

    // Logout
    const logoutBtn = document.getElementById("logoutBtn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", async () => {
        try {
          await auth.signOut();
          document.getElementById("profile-box").style.display = "none";
          localStorage.setItem("gsu_logged_out", "true");
          window.location.href = "index.html";
        } catch (err) {
          alert("Error signing out: " + err.message);
        }
      });
    }

    // Expose
    window.db = db; window.doc = doc; window.setDoc = setDoc; window.getAuth = getAuth; window.auth = auth;

    window.openEditModal = function () {
      document.getElementById('editModal').style.display = 'block';
      document.getElementById('editGames').value = document.getElementById('fav-games').textContent.replace('üî• Favorite Games: ', '');
      document.getElementById('editGamesPlayed').value = document.getElementById('games-played').textContent.replace('üéÆ Number Of Games Played: ', '');
      document.getElementById('editTrophies').value = document.getElementById('trophy-stats').textContent.replace('üèÜ Trophy Stats (Total Trophies): ', '');
      document.getElementById('editUsername').value = document.querySelector(".username-info")?.textContent.replace("üë§ Username: ", "") || '';
      document.getElementById('editPlatform').value = document.querySelector(".platform-info")?.textContent.replace("üîπ Platform: ", "") || '';
    };
    window.closeEditModal = function () { document.getElementById('editModal').style.display = 'none'; };

    window.saveProfileChanges = async function () {
      const user = auth.currentUser;
      if (!user) { alert("You must be signed in to update your profile."); return; }

      const games = document.getElementById('editGames').value.trim();
      const gamesPlayed = document.getElementById('editGamesPlayed').value.trim();
      const imageUrls = document.getElementById('editGameImages').value.split(',').map(s => s.trim()).filter(Boolean);
      const trophies = document.getElementById('editTrophies').value.trim();
      const username = document.getElementById('editUsername').value.trim();
      const platform = document.getElementById('editPlatform').value;

      const uid = user.uid;
      await setDoc(doc(db, "users", uid), {
        username,
        platform,
        favoriteGames: games ? games.split(',').map(s => s.trim()) : [],
        gamesPlayed: gamesPlayed ? parseInt(gamesPlayed) : 0,
        favoriteImages: imageUrls,
        trophyCount: trophies ? parseInt(trophies) : 0
      }, { merge: true });

      // instant UI update
      const profileBox = document.getElementById("profile-box");
      let usernameEl = profileBox.querySelector(".username-info");
      if (!usernameEl) { usernameEl = document.createElement("p"); usernameEl.className="username-info"; usernameEl.style.fontWeight="bold"; usernameEl.style.fontSize="1rem"; usernameEl.style.marginBottom="0.5rem"; profileBox.prepend(usernameEl); }
      usernameEl.textContent = `üë§ Username: ${username || "N/A"}`;

      let platformEl = profileBox.querySelector(".platform-info");
      if (!platformEl) { platformEl = document.createElement("p"); platformEl.className="platform-info"; platformEl.style.fontSize="0.95rem"; platformEl.style.marginBottom="0.5rem"; usernameEl.insertAdjacentElement("afterend", platformEl); }
      platformEl.textContent = `üîπ Platform: ${platform || "N/A"}`;

      document.getElementById('fav-games').textContent = `üî• Favorite Games: ${games || "N/A"}`;
      document.getElementById('games-played').textContent = `üéÆ Number Of Games Played: ${gamesPlayed || "N/A"}`;
      document.getElementById('trophy-stats').textContent = `üèÜ Trophy Stats (Total Trophies): ${trophies || "N/A"}`;

      const imageRow = document.getElementById("fav-images");
      imageRow.innerHTML = "";
      imageUrls.forEach(url => {
        const img = document.createElement("img");
        img.src = url; img.alt = "Game cover"; img.classList.add("profile-fav-img");
        imageRow.appendChild(img);
        img.classList.add("update-flash-img"); setTimeout(() => img.classList.remove("update-flash-img"), 1300);
      });

      [usernameEl, platformEl, document.getElementById('fav-games'), document.getElementById('games-played'), document.getElementById('trophy-stats'), imageRow].forEach(el => {
        el.classList.remove('update-flash'); void el.offsetWidth; el.classList.add('update-flash');
      });

      window.closeEditModal();
    };

    // Show/hide personalized sections based on auth
    onAuthStateChanged(auth, (user) => {
      const profileBox = document.getElementById("profile-box");
      if (user) { loadProfile(user.uid); if (profileBox) profileBox.style.display = "block"; }
      else      { if (profileBox) profileBox.style.display = "none"; showAuthNotice(); setTimeout(hideAuthNotice, 10000); }
    });

    // Expose simple notice fns
    window.showAuthNotice = function(){ const b=document.getElementById("authNotice"); const o=document.getElementById("authOverlay"); if(b) b.style.display="block"; if(o) o.style.display="block"; }
    window.hideAuthNotice = function(){ const b=document.getElementById("authNotice"); const o=document.getElementById("authOverlay"); if(b) b.style.display="none"; if(o) o.style.display="none"; }
  </script>

  <!-- Stats + Spotlight (YouTube) -->
  <script type="module">
    import { getFirestore, collection, query, where, orderBy, limit, getDocs, getCountFromServer, Timestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

    const db = window.db || getFirestore();
    const auth = window.auth || getAuth();
    const spotlightRef = document.getElementById("fav-game-updates");
    const apiKey = "AIzaSyBtVEG3436lk_I4gfKCAxYSRv_IBU6lcBA";

    async function firstExistingCollection(names){
      for (const name of names){
        try { await getDocs(query(collection(db, name), limit(1))); return name; } catch(e){/* try next */ }
      } return null;
    }

    async function safeCount({ names, filter=null }){
      const colName = await firstExistingCollection(names);
      if (!colName) return 0;
      try {
        const base = collection(db, colName);
        const q = Array.isArray(filter) ? query(base, ...filter) : (filter ? query(base, filter) : base);
        const res = await getCountFromServer(q);
        return res.data().count || 0;
      } catch(e){ console.warn("Count error for", names, e); return 0; }
    }

    function setText(id, val){ const el=document.getElementById(id); if(el) el.textContent = String(val); }

    async function populateStats(){
      const sevenDaysAgo = Timestamp.fromDate(new Date(Date.now() - 7*24*3600*1000));

      const totalMembers = await safeCount({ names:["users","members","gsu_users"] });
      const newMembers   = await safeCount({ names:["users","members","gsu_users"], filter:[ where("createdAt", ">=", sevenDaysAgo) ] });
      const videoUploads = await (async () => {
        try { const n = await safeCount({ names:["videos","uploads","community_videos"], filter:[ where("type","in",["video","gameplay"]) ] }); if (n>0) return n; } catch(_){}
        return safeCount({ names:["videos","uploads","community_videos"] });
      })();
      const fanArt   = await safeCount({ names:["art","fan_art","fanArt"] });
      const trophies = await safeCount({ names:["trophies","achievements","player_trophies"] });
      const combos   = await (async () => {
        try { const n = await safeCount({ names:["videos","combo_guides","combos"], filter:[ where("type","in",["combo","guide"]) ] }); if (n>0) return n; } catch(_){}
        return safeCount({ names:["combo_guides","combos"] });
      })();
      let pollVotes = await safeCount({ names:["poll_votes","votes"] });
      if (!pollVotes) {
        try {
          const col = await firstExistingCollection(["polls","community_polls"]);
          if (col){
            const qs = await getDocs(collection(db, col));
            pollVotes = qs.docs.reduce((sum,d)=> sum + (Number(d.data().totalVotes||0)), 0);
          }
        } catch(_){}
      }

      setText("totalMembers", totalMembers);
      setText("newMembers", newMembers);
      setText("videoUploads", videoUploads);
      setText("fanArt",      fanArt);
      setText("trophies",    trophies);
      setText("combos",      combos);
      setText("pollVotes",   pollVotes);
    }

    async function rotateYouTubeVideosForUser(uid){
      try{
        const snap = await getDoc(doc(db,"users",uid));
        if (!snap.exists()){ spotlightRef.innerHTML = "<p style='color:red; text-align:center;'>‚ùå No user data found.</p>"; return; }
        const { favoriteGames } = snap.data();
        if (!Array.isArray(favoriteGames) || !favoriteGames.length){
          spotlightRef.innerHTML = "<p style='color:red; text-align:center;'>‚ùå No favorite games set.</p>"; return;
        }
        spotlightRef.innerHTML = "<p style='text-align:center;'>üîÑ Loading gameplay drops...</p>";

        const blocks = await Promise.all(
          favoriteGames.slice(0,3).map(async (title) => {
            const cleanTitle = title.replace(/[^\w\s:]/gi, "").trim();
            try{
              const res = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${apiKey}&part=snippet&type=video&maxResults=5&q=${encodeURIComponent(cleanTitle + " gameplay")}`);
              const data = await res.json();

              if (data?.error?.errors?.[0]?.reason === 'quotaExceeded'){
                return `
                  <div style="color: var(--gsu-red); text-align: center; padding: 1rem;">
                    Today‚Äôs video drops are temporarily unavailable. Check back tomorrow for fresh gameplay!
                    <br/><br/>
                    <button onclick="window.location.href='uploads.html'" style="background-color: var(--gsu-red); color: white; border: none; padding: 0.6rem 1rem; border-radius: 6px; cursor: pointer; font-family: 'Montserrat', sans-serif; font-weight: 600;">
                      Explore GSU Player Lounge
                    </button>
                  </div>
                `;
              }

              const video = data.items?.find(item => item.id.kind === "youtube#video");
              const videoId = video?.id?.videoId;
              if (!videoId) throw new Error("No videos found");

              return `
                <div class="spotlight-video">
                  <iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe>
                  <h3>üéÆ ${title}</h3>
                  <p>‚ñ∂Ô∏è Daily gameplay drop powered by YouTube</p>
                </div>
              `;
            } catch(err){
              console.error(`Error loading video for ${title}:`, err);
              return `<div style="color:red; text-align:center;">‚ùå Failed to load video for <strong>${title}</strong></div>`;
            }
          })
        );
        spotlightRef.innerHTML = blocks.join("");
      } catch(e){
        console.error("Error fetching YouTube videos:", e);
        spotlightRef.innerHTML = `<p style="color:red; text-align:center;">‚ùå Could not load personalized videos.</p>`;
      }
    }

    async function runAll(){
      await populateStats();
      const user = auth.currentUser;
      if (user) rotateYouTubeVideosForUser(user.uid);
      else spotlightRef.innerHTML = `<p style="color:red; text-align:center;">‚ùå Please log in to see personalized videos.</p>`;
    }

    document.addEventListener('DOMContentLoaded', runAll);
    onAuthStateChanged(auth, () => runAll());
  </script>

  <script type="module">
    import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
    window.submitGameReview = async () => {
      const title = document.getElementById("reviewGame").value.trim();
      const content = document.getElementById("reviewText").value.trim();
      const user = window.auth.currentUser;
      if (!user || !title || !content) { alert("You must be signed in and fill out both fields."); return; }
      try {
        await addDoc(collection(window.db, "game_reviews"), { title, review:content, userId:user.uid, username:user.email, timestamp: serverTimestamp() });
        alert("‚úÖ Review submitted successfully!"); document.getElementById("reviewGame").value=""; document.getElementById("reviewText").value="";
      } catch (err) { console.error("‚ùå Error submitting review:", err); alert("Something went wrong while saving your review."); }
    };
  </script>

  <div id="authNotice" style="display:none; position:fixed; top:12%; left:50%; transform:translateX(-50%); background:#ffffff; color:#e60023; border:2px solid #e60023; padding:1.25rem 1.5rem; border-radius:12px; z-index:9999; font-family:'Montserrat',sans-serif; font-size:.95rem; max-width:360px; box-shadow:0 0 20px rgba(0,0,0,.3); text-align:center; line-height:1.6;">
    <div style="color:#000; font-weight:bold; margin-bottom:.75rem; font-size:1rem;">Signed out:</div>
    <div style="margin-bottom:1rem;">Access limited ‚Äî sign in or create your GSU account to get the full GSU experience.</div>
    <button onclick="hideAuthNotice()" style="background:#e60023; color:#fff; border:none; padding:.5rem 1rem; border-radius:8px; font-family:'Montserrat'; cursor:pointer;">Close</button>
  </div>
  <div id="authOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,.5); z-index:9998;"></div>

  <!-- Optional local modules (safe to keep; remove if not used) -->
  <script type="module">
    import './firebase-init.js';
    import './profile-loader.js';
  </script>
</body>
</html>
